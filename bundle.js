/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},n=function(e,t){if(!e)throw i(t)},i=function(e){return new Error("Firebase Database ("+t.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},s=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const s=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,h=a?e[t+2]:0,l=s>>2,c=(3&s)<<4|o>>4;let u=(15&o)<<2|h>>6,d=63&h;a||(d=64,r||(u=64)),i.push(n[l],n[c],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],r=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const h=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==r||null==a||null==h)throw new o;const l=s<<2|r>>4;if(i.push(l),64!==a){const e=r<<4&240|a>>2;if(i.push(e),64!==h){const e=a<<6&192|h;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){const t=s(e);return r.encodeByteArray(t,!0)},h=function(e){return a(e).replace(/\./g,"")},l=function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(e){return u(void 0,e)}function u(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=u(e[n],t[n]));return e}const d=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&l(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},p=e=>{var t,n;return null===(n=null===(t=d())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},f=()=>{var e;return null===(e=d())||void 0===e?void 0:e.config},g=e=>{var t;return null===(t=d())||void 0===t?void 0:t[`_${e}`]};class m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function _(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function y(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_())}function v(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function w(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function I(){return!0===t.NODE_CLIENT||!0===t.NODE_ADMIN}function b(){try{return"object"==typeof indexedDB}catch(e){return!1}}function T(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class E extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,E.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,C.prototype.create)}}class C{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(k,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new E(i,o,n)}}const k=/\{\$([^}]+)}/g;function S(e){return JSON.parse(e)}function R(e){return JSON.stringify(e)}const N=function(e){let t={},n={},i={},s="";try{const r=e.split(".");t=S(l(r[0])||""),n=S(l(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:s}};function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function O(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function D(e,t,n){const i={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=t.call(n,e[s],s,e));return i}function L(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(x(n)&&x(r)){if(!L(n,r))return!1}else if(n!==r)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function x(e){return null!==e&&"object"==typeof e}function M(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function F(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function U(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class j{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=h^o&(a^h),s=1518500249):(i=o^a^h,s=1859775393):e<60?(i=o&a|h&(o|a),s=2400959708):(i=o^a^h,s=3395469782);const t=(r<<5|r>>>27)+i+l+s+n[e]&4294967295;l=h,h=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<t;){if(0===r)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(s[r]=e.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<t;)if(s[r]=e[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class q{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=H),void 0===i.error&&(i.error=H),void 0===i.complete&&(i.complete=H);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function H(){}const B=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t},V=1e3,W=2,z=144e5,$=.5;function K(e,t=V,n=W){const i=t*Math.pow(n,e),s=Math.round($*i*(Math.random()-.5)*2);return Math.min(z,i+s)}function G(e){return e&&e._delegate?e._delegate:e}class Y{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const X="[DEFAULT]";class J{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new m;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:X})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=X){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=X){return this.instances.has(e)}getOptions(e=X){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===X?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=X){return this.component?this.component.multipleInstances?e:X:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Q{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new J(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Z=[];var ee,te;(te=ee||(ee={}))[te.DEBUG=0]="DEBUG",te[te.VERBOSE=1]="VERBOSE",te[te.INFO=2]="INFO",te[te.WARN=3]="WARN",te[te.ERROR=4]="ERROR",te[te.SILENT=5]="SILENT";const ne={debug:ee.DEBUG,verbose:ee.VERBOSE,info:ee.INFO,warn:ee.WARN,error:ee.ERROR,silent:ee.SILENT},ie=ee.INFO,se={[ee.DEBUG]:"log",[ee.VERBOSE]:"log",[ee.INFO]:"info",[ee.WARN]:"warn",[ee.ERROR]:"error"},re=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),s=se[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${i}]  ${e.name}:`,...n)};class oe{constructor(e){this.name=e,this._logLevel=ie,this._logHandler=re,this._userLogHandler=null,Z.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ee))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ne[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ee.DEBUG,...e),this._logHandler(this,ee.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ee.VERBOSE,...e),this._logHandler(this,ee.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ee.INFO,...e),this._logHandler(this,ee.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ee.WARN,...e),this._logHandler(this,ee.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ee.ERROR,...e),this._logHandler(this,ee.ERROR,...e)}}const ae=(e,t)=>t.some((t=>e instanceof t));let he,le;const ce=new WeakMap,ue=new WeakMap,de=new WeakMap,pe=new WeakMap,fe=new WeakMap;let ge={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ue.get(e);if("objectStoreNames"===t)return e.objectStoreNames||de.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return _e(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function me(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(le||(le=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ye(this),e),_e(ce.get(this))}:function(...e){return _e(t.apply(ye(this),e))}:function(e,...n){const i=t.call(ye(this),e,...n);return de.set(i,e.sort?e.sort():[e]),_e(i)}:(e instanceof IDBTransaction&&function(e){if(ue.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));ue.set(e,t)}(e),ae(e,he||(he=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,ge):e);var t}function _e(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(_e(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&ce.set(t,e)})).catch((()=>{})),fe.set(t,e),t}(e);if(pe.has(e))return pe.get(e);const t=me(e);return t!==e&&(pe.set(e,t),fe.set(t,e)),t}const ye=e=>fe.get(e);function ve(e,t,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(e,t),a=_e(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(_e(o.result),e.oldVersion,e.newVersion,_e(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}const we=["get","getKey","getAll","getAllKeys","count"],Ie=["put","add","delete","clear"],be=new Map;function Te(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(be.get(t))return be.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=Ie.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!we.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return be.set(t,r),r}var Ee;Ee=ge,ge={...Ee,get:(e,t,n)=>Te(e,t)||Ee.get(e,t,n),has:(e,t)=>!!Te(e,t)||Ee.has(e,t)};class Ce{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ke="@firebase/app",Se="0.9.5",Re=new oe("@firebase/app"),Ne="[DEFAULT]",Ae={[ke]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Pe=new Map,Oe=new Map;function De(e,t){try{e.container.addComponent(t)}catch(n){Re.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Le(e){const t=e.name;if(Oe.has(t))return Re.debug(`There were multiple attempts to register component ${t}.`),!1;Oe.set(t,e);for(const t of Pe.values())De(t,e);return!0}function xe(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Me=new C("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Fe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Y("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Me.create("app-deleted",{appName:this._name})}}const Ue="9.18.0";function je(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:Ne,automaticDataCollectionEnabled:!1},t),s=i.name;if("string"!=typeof s||!s)throw Me.create("bad-app-name",{appName:String(s)});if(n||(n=f()),!n)throw Me.create("no-options");const r=Pe.get(s);if(r){if(L(n,r.options)&&L(i,r.config))return r;throw Me.create("duplicate-app",{appName:s})}const o=new Q(s);for(const e of Oe.values())o.addComponent(e);const a=new Fe(n,i,o);return Pe.set(s,a),a}function qe(e=Ne){const t=Pe.get(e);if(!t&&e===Ne)return je();if(!t)throw Me.create("no-app",{appName:e});return t}function He(e,t,n){var i;let s=null!==(i=Ae[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Re.warn(e.join(" "))}Le(new Y(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const Be="firebase-heartbeat-database",Ve=1,We="firebase-heartbeat-store";let ze=null;function $e(){return ze||(ze=ve(Be,Ve,{upgrade:(e,t)=>{0===t&&e.createObjectStore(We)}}).catch((e=>{throw Me.create("idb-open",{originalErrorMessage:e.message})}))),ze}async function Ke(e,t){try{const n=(await $e()).transaction(We,"readwrite"),i=n.objectStore(We);return await i.put(t,Ge(e)),n.done}catch(e){if(e instanceof E)Re.warn(e.message);else{const t=Me.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Re.warn(t.message)}}}function Ge(e){return`${e.name}!${e.options.appId}`}class Ye{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Je(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Xe();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Xe(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),Qe(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Qe(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=h(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Xe(){return(new Date).toISOString().substring(0,10)}class Je{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!b()&&T().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{return(await $e()).transaction(We).objectStore(We).get(Ge(e))}catch(e){if(e instanceof E)Re.warn(e.message);else{const t=Me.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Re.warn(t.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ke(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ke(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Qe(e){return h(JSON.stringify({version:2,heartbeats:e})).length}Le(new Y("platform-logger",(e=>new Ce(e)),"PRIVATE")),Le(new Y("heartbeat",(e=>new Ye(e)),"PRIVATE")),He(ke,Se,""),He(ke,Se,"esm2017"),He("fire-js",""),He("firebase","9.18.0","app");const Ze="@firebase/installations",et="0.6.4",tt=1e4,nt=`w:${et}`,it="FIS_v2",st="https://firebaseinstallations.googleapis.com/v1",rt=36e5,ot=new C("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function at(e){return e instanceof E&&e.code.includes("request-failed")}function ht({projectId:e}){return`${st}/projects/${e}/installations`}function lt(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function ct(e,t){const n=(await t.json()).error;return ot.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ut({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function dt(e){const t=await e();return t.status>=500&&t.status<600?e():t}function pt(e){return new Promise((t=>{setTimeout(t,e)}))}const ft=/^[cdef][\w-]{21}$/,gt="";function mt(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return ft.test(t)?t:gt}catch(e){return gt}}function _t(e){return`${e.appName}!${e.appId}`}const yt=new Map;function vt(e,t){const n=_t(e);wt(n,t),function(e,t){const n=(!It&&"BroadcastChannel"in self&&(It=new BroadcastChannel("[Firebase] FID Change"),It.onmessage=e=>{wt(e.data.key,e.data.fid)}),It);n&&n.postMessage({key:e,fid:t}),0===yt.size&&It&&(It.close(),It=null)}(n,t)}function wt(e,t){const n=yt.get(e);if(n)for(const e of n)e(t)}let It=null;const bt="firebase-installations-database",Tt=1,Et="firebase-installations-store";let Ct=null;function kt(){return Ct||(Ct=ve(bt,Tt,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Et)}})),Ct}async function St(e,t){const n=_t(e),i=(await kt()).transaction(Et,"readwrite"),s=i.objectStore(Et),r=await s.get(n);return await s.put(t,n),await i.done,r&&r.fid===t.fid||vt(e,t.fid),t}async function Rt(e){const t=_t(e),n=(await kt()).transaction(Et,"readwrite");await n.objectStore(Et).delete(t),await n.done}async function Nt(e,t){const n=_t(e),i=(await kt()).transaction(Et,"readwrite"),s=i.objectStore(Et),r=await s.get(n),o=t(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||vt(e,o.fid),o}async function At(e){let t;const n=await Nt(e.appConfig,(n=>{const i=function(e){return Dt(e||{fid:mt(),registrationStatus:0})}(n),s=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(ot.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=ht(e),s=ut(e),r=t.getImmediate({optional:!0});if(r){const e=await r.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const o={fid:n,authVersion:it,appId:e.appId,sdkVersion:nt},a={method:"POST",headers:s,body:JSON.stringify(o)},h=await dt((()=>fetch(i,a)));if(h.ok){const e=await h.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:lt(e.authToken)}}throw await ct("Create Installation",h)}(e,t);return St(e.appConfig,n)}catch(n){throw at(n)&&409===n.customData.serverCode?await Rt(e.appConfig):await St(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Pt(e)}:{installationEntry:t}}(e,i);return t=s.registrationPromise,s.installationEntry}));return n.fid===gt?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Pt(e){let t=await Ot(e.appConfig);for(;1===t.registrationStatus;)await pt(100),t=await Ot(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await At(e);return n||t}return t}function Ot(e){return Nt(e,(e=>{if(!e)throw ot.create("installation-not-found");return Dt(e)}))}function Dt(e){return 1===(t=e).registrationStatus&&t.registrationTime+tt<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Lt({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${ht(e)}/${t}/authTokens:generate`}(e,n),s=function(e,{refreshToken:t}){const n=ut(e);return n.append("Authorization",function(e){return`${it} ${e}`}(t)),n}(e,n),r=t.getImmediate({optional:!0});if(r){const e=await r.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const o={installation:{sdkVersion:nt,appId:e.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},h=await dt((()=>fetch(i,a)));if(h.ok)return lt(await h.json());throw await ct("Generate Auth Token",h)}async function xt(e,t=!1){let n;const i=await Nt(e.appConfig,(i=>{if(!Ft(i))throw ot.create("not-registered");const s=i.authToken;if(!t&&(2===(r=s).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+rt}(r)))return i;var r;if(1===s.requestStatus)return n=async function(e,t){let n=await Mt(e.appConfig);for(;1===n.authToken.requestStatus;)await pt(100),n=await Mt(e.appConfig);const i=n.authToken;return 0===i.requestStatus?xt(e,t):i}(e,t),i;{if(!navigator.onLine)throw ot.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await Lt(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await St(e.appConfig,i),n}catch(n){if(!at(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await St(e.appConfig,n)}else await Rt(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function Mt(e){return Nt(e,(e=>{if(!Ft(e))throw ot.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+tt<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function Ft(e){return void 0!==e&&2===e.registrationStatus}function Ut(e){return ot.create("missing-app-config-values",{valueName:e})}const jt="installations";Le(new Y(jt,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Ut("App Configuration");if(!e.name)throw Ut("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Ut(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:xe(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Le(new Y("installations-internal",(e=>{const t=xe(e.getProvider("app").getImmediate(),jt).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await At(t);return i?i.catch(console.error):xt(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await At(e);t&&await t}(n),(await xt(n,t)).token}(t,e)}}),"PRIVATE")),He(Ze,et),He(Ze,et,"esm2017");const qt="analytics",Ht="firebase_id",Bt="origin",Vt=6e4,Wt="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",zt="https://www.googletagmanager.com/gtag/js",$t=new oe("@firebase/analytics");function Kt(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const Gt=new C("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Yt=30,Xt=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Jt(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Qt(e,t=Xt,n){const{appId:i,apiKey:s,measurementId:r}=e.options;if(!i)throw Gt.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Gt.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new en;return setTimeout((async()=>{a.abort()}),void 0!==n?n:Vt),Zt({appId:i,apiKey:s,measurementId:r},o,a,t)}async function Zt(e,{throttleEndTimeMillis:t,backoffCount:n},i,s=Xt){var r;const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,i)=>{const s=Math.max(t-Date.now(),0),r=setTimeout(n,s);e.addEventListener((()=>{clearTimeout(r),i(Gt.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(e){if(a)return $t.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,s={method:"GET",headers:Jt(i)},r=Wt.replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw Gt.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return s.deleteThrottleMetadata(o),t}catch(t){const h=t;if(!function(e){if(!(e instanceof E&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(h)){if(s.deleteThrottleMetadata(o),a)return $t.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==h?void 0:h.message}]`),{appId:o,measurementId:a};throw t}const l=503===Number(null===(r=null==h?void 0:h.customData)||void 0===r?void 0:r.httpStatus)?K(n,s.intervalMillis,Yt):K(n,s.intervalMillis),c={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return s.setThrottleMetadata(o,c),$t.debug(`Calling attemptFetch again in ${l} millis`),Zt(e,c,i,s)}}class en{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let tn,nn;async function sn(e,t,n,i,s,r,o){var a;const h=Qt(e);h.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&$t.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>$t.error(e))),t.push(h);const l=async function(){if(!b())return $t.warn(Gt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await T()}catch(e){return $t.warn(Gt.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[c,u]=await Promise.all([h,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(zt)&&n.src.includes(e))return n;return null})(r)||function(e,t){const n=document.createElement("script");n.src=`${zt}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(r,c.measurementId),nn&&(s("consent","default",nn),nn=void 0),s("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d[Bt]="firebase",d.update=!0,null!=u&&(d[Ht]=u),s("config",c.measurementId,d),tn&&(s("set",tn),tn=void 0),c.measurementId}class rn{constructor(e){this.app=e}_delete(){return delete on[this.app.options.appId],Promise.resolve()}}let on={},an=[];const hn={};let ln,cn,un="dataLayer",dn="gtag",pn=!1;function fn(e,t,n){!function(){const e=[];if(v()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=Gt.create("invalid-analytics-context",{errorInfo:t});$t.warn(n.message)}}();const i=e.options.appId;if(!i)throw Gt.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Gt.create("no-api-key");$t.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=on[i])throw Gt.create("already-exists",{id:i});if(!pn){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(un);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,s){let r=function(...e){window[i].push(arguments)};return window[s]&&"function"==typeof window[s]&&(r=window[s]),window[s]=function(e,t,n,i){return async function(s,r,o){try{"event"===s?await async function(e,t,n,i,s){try{let r=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const i=await Kt(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),s=e&&t[e.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(t)),await Promise.all(r),e("event",i,s||{})}catch(e){$t.error(e)}}(e,t,n,r,o):"config"===s?await async function(e,t,n,i,s,r){const o=i[s];try{if(o)await t[o];else{const e=(await Kt(n)).find((e=>e.measurementId===s));e&&await t[e.appId]}}catch(e){$t.error(e)}e("config",s,r)}(e,t,n,i,r,o):"consent"===s?e("consent","update",o):e("set",r)}catch(e){$t.error(e)}}}(r,e,t,n),{gtagCore:r,wrappedGtag:window[s]}}(on,an,hn,un,dn);cn=e,ln=t,pn=!0}return on[i]=sn(e,an,hn,t,ln,un,n),new rn(e)}const gn="@firebase/analytics",mn="0.9.4";Le(new Y(qt,((e,{options:t})=>fn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),Le(new Y("analytics-internal",(function(e){try{const t=e.getProvider(qt).getImmediate();return{logEvent:(e,n,i)=>function(e,t,n,i){e=G(e),async function(e,t,n,i,s){if(s&&s.global)e("event",n,i);else{const s=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(cn,on[e.app.options.appId],t,n,i).catch((e=>$t.error(e)))}(t,e,n,i)}}catch(e){throw Gt.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),He(gn,mn),He(gn,mn,"esm2017");var _n,yn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e.g?e.g:"undefined"!=typeof self?self:{},vn={},wn=wn||{},In=yn||self;function bn(){}function Tn(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function En(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Cn="closure_uid_"+(1e9*Math.random()>>>0),kn=0;function Sn(e,t,n){return e.call.apply(e.bind,arguments)}function Rn(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Nn(e,t,n){return(Nn=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Sn:Rn).apply(null,arguments)}function An(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Pn(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Wb=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}function On(){this.s=this.s,this.o=this.o}On.prototype.s=!1,On.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Cn)&&e[Cn]||(e[Cn]=++kn))},On.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Dn=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Ln(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function xn(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Tn(n)){const t=e.length||0,i=n.length||0;e.length=t+i;for(let s=0;s<i;s++)e[t+s]=n[s]}else e.push(n)}}function Mn(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Mn.prototype.h=function(){this.defaultPrevented=!0};var Fn=function(){if(!In.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{In.addEventListener("test",bn,t),In.removeEventListener("test",bn,t)}catch(e){}return e}();function Un(e){return/^[\s\xa0]*$/.test(e)}var jn=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function qn(e,t){return e<t?-1:e>t?1:0}function Hn(){var e=In.navigator;return e&&(e=e.userAgent)?e:""}function Bn(e){return-1!=Hn().indexOf(e)}function Vn(e){return Vn[" "](e),e}Vn[" "]=bn;var Wn,zn,$n=Bn("Opera"),Kn=Bn("Trident")||Bn("MSIE"),Gn=Bn("Edge"),Yn=Gn||Kn,Xn=Bn("Gecko")&&!(-1!=Hn().toLowerCase().indexOf("webkit")&&!Bn("Edge"))&&!(Bn("Trident")||Bn("MSIE"))&&!Bn("Edge"),Jn=-1!=Hn().toLowerCase().indexOf("webkit")&&!Bn("Edge");function Qn(){var e=In.document;return e?e.documentMode:void 0}e:{var Zn="",ei=(zn=Hn(),Xn?/rv:([^\);]+)(\)|;)/.exec(zn):Gn?/Edge\/([\d\.]+)/.exec(zn):Kn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(zn):Jn?/WebKit\/(\S+)/.exec(zn):$n?/(?:Version)[ \/]?(\S+)/.exec(zn):void 0);if(ei&&(Zn=ei?ei[1]:""),Kn){var ti=Qn();if(null!=ti&&ti>parseFloat(Zn)){Wn=String(ti);break e}}Wn=Zn}var ni,ii={};function si(){return function(e){var t=ii;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let e=0;const t=jn(String(Wn)).split("."),n=jn("9").split("."),i=Math.max(t.length,n.length);for(let o=0;0==e&&o<i;o++){var s=t[o]||"",r=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==s[0].length&&0==r[0].length)break;e=qn(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||qn(0==s[2].length,0==r[2].length)||qn(s[2],r[2]),s=s[3],r=r[3]}while(0==e)}return 0<=e}()}()}In.document&&Kn?ni=Qn()||parseInt(Wn,10)||void 0:ni=void 0;var ri=ni;function oi(e,t){if(Mn.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Xn){e:{try{Vn(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:ai[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&oi.X.h.call(this)}}Pn(oi,Mn);var ai={2:"touch",3:"pen",4:"mouse"};oi.prototype.h=function(){oi.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var hi="closure_listenable_"+(1e6*Math.random()|0),li=0;function ci(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=s,this.key=++li,this.ba=this.ea=!1}function ui(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function di(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function pi(e){const t={};for(const n in e)t[n]=e[n];return t}const fi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function gi(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t],i)e[n]=i[n];for(let t=0;t<fi.length;t++)n=fi[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function mi(e){this.src=e,this.g={},this.h=0}function _i(e,t){var n=t.type;if(n in e.g){var i,s=e.g[n],r=Dn(s,t);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(ui(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function yi(e,t,n,i){for(var s=0;s<e.length;++s){var r=e[s];if(!r.ba&&r.listener==t&&r.capture==!!n&&r.ha==i)return s}return-1}mi.prototype.add=function(e,t,n,i,s){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var o=yi(e,t,i,s);return-1<o?(t=e[o],n||(t.ea=!1)):((t=new ci(t,this.src,r,!!i,s)).ea=n,e.push(t)),t};var vi="closure_lm_"+(1e6*Math.random()|0),wi={};function Ii(e,t,n,i,s){if(i&&i.once)return Ti(e,t,n,i,s);if(Array.isArray(t)){for(var r=0;r<t.length;r++)Ii(e,t[r],n,i,s);return null}return n=Ai(n),e&&e[hi]?e.N(t,n,En(i)?!!i.capture:!!i,s):bi(e,t,n,!1,i,s)}function bi(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");var o=En(s)?!!s.capture:!!s,a=Ri(e);if(a||(e[vi]=a=new mi(e)),(n=a.add(t,n,i,o,r)).proxy)return n;if(i=function(){const e=Si;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)Fn||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(ki(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function Ti(e,t,n,i,s){if(Array.isArray(t)){for(var r=0;r<t.length;r++)Ti(e,t[r],n,i,s);return null}return n=Ai(n),e&&e[hi]?e.O(t,n,En(i)?!!i.capture:!!i,s):bi(e,t,n,!0,i,s)}function Ei(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)Ei(e,t[r],n,i,s);else i=En(i)?!!i.capture:!!i,n=Ai(n),e&&e[hi]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=yi(r=e.g[t],n,i,s))&&(ui(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--))):e&&(e=Ri(e))&&(t=e.g[t.toString()],e=-1,t&&(e=yi(t,n,i,s)),(n=-1<e?t[e]:null)&&Ci(n))}function Ci(e){if("number"!=typeof e&&e&&!e.ba){var t=e.src;if(t&&t[hi])_i(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(ki(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=Ri(t))?(_i(n,e),0==n.h&&(n.src=null,t[vi]=null)):ui(e)}}}function ki(e){return e in wi?wi[e]:wi[e]="on"+e}function Si(e,t){if(e.ba)e=!0;else{t=new oi(t,this);var n=e.listener,i=e.ha||e.src;e.ea&&Ci(e),e=n.call(i,t)}return e}function Ri(e){return(e=e[vi])instanceof mi?e:null}var Ni="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ai(e){return"function"==typeof e?e:(e[Ni]||(e[Ni]=function(t){return e.handleEvent(t)}),e[Ni])}function Pi(){On.call(this),this.i=new mi(this),this.P=this,this.I=null}function Oi(e,t){var n,i=e.I;if(i)for(n=[];i;i=i.I)n.push(i);if(e=e.P,i=t.type||t,"string"==typeof t)t=new Mn(t,e);else if(t instanceof Mn)t.target=t.target||e;else{var s=t;gi(t=new Mn(i,e),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=t.g=n[r];s=Di(o,i,!0,t)&&s}if(s=Di(o=t.g=e,i,!0,t)&&s,s=Di(o,i,!1,t)&&s,n)for(r=0;r<n.length;r++)s=Di(o=t.g=n[r],i,!1,t)&&s}function Di(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,r=0;r<t.length;++r){var o=t[r];if(o&&!o.ba&&o.capture==n){var a=o.listener,h=o.ha||o.src;o.ea&&_i(e.i,o),s=!1!==a.call(h,i)&&s}}return s&&!i.defaultPrevented}Pn(Pi,On),Pi.prototype[hi]=!0,Pi.prototype.removeEventListener=function(e,t,n,i){Ei(this,e,t,n,i)},Pi.prototype.M=function(){if(Pi.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)ui(n[i]);delete t.g[e],t.h--}}this.I=null},Pi.prototype.N=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},Pi.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var Li=In.JSON.stringify;function xi(){var e=Bi;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Mi,Fi=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Ui),(e=>e.reset()));class Ui{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ji(e){In.setTimeout((()=>{throw e}),0)}function qi(e,t){Mi||function(){var e=In.Promise.resolve(void 0);Mi=function(){e.then(Vi)}}(),Hi||(Mi(),Hi=!0),Bi.add(e,t)}var Hi=!1,Bi=new class{constructor(){this.h=this.g=null}add(e,t){const n=Fi.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Vi(){for(var e;e=xi();){try{e.h.call(e.g)}catch(e){ji(e)}var t=Fi;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Hi=!1}function Wi(e,t){Pi.call(this),this.h=e||1,this.g=t||In,this.j=Nn(this.lb,this),this.l=Date.now()}function zi(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function $i(e,t,n){if("function"==typeof e)n&&(e=Nn(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Nn(e.handleEvent,e)}return 2147483647<Number(t)?-1:In.setTimeout(e,t||0)}function Ki(e){e.g=$i((()=>{e.g=null,e.i&&(e.i=!1,Ki(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Pn(Wi,Pi),(_n=Wi.prototype).ca=!1,_n.R=null,_n.lb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Oi(this,"tick"),this.ca&&(zi(this),this.start()))}},_n.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},_n.M=function(){Wi.X.M.call(this),zi(this),delete this.g};class Gi extends On{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Ki(this)}M(){super.M(),this.g&&(In.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yi(e){On.call(this),this.h=e,this.g={}}Pn(Yi,On);var Xi=[];function Ji(e,t,n,i){Array.isArray(n)||(n&&(Xi[0]=n.toString()),n=Xi);for(var s=0;s<n.length;s++){var r=Ii(t,n[s],i||e.handleEvent,!1,e.h||e);if(!r)break;e.g[r.key]=r}}function Qi(e){di(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ci(e)}),e),e.g={}}function Zi(){this.g=!0}function es(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return Li(n)}catch(e){return t}}(e,n)+(i?" "+i:"")}))}Yi.prototype.M=function(){Yi.X.M.call(this),Qi(this)},Yi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Zi.prototype.Aa=function(){this.g=!1},Zi.prototype.info=function(){};var ts={},ns=null;function is(){return ns=ns||new Pi}function ss(e){Mn.call(this,ts.Pa,e)}function rs(e){const t=is();Oi(t,new ss(t))}function os(e,t){Mn.call(this,ts.STAT_EVENT,e),this.stat=t}function as(e){const t=is();Oi(t,new os(t,e))}function hs(e,t){Mn.call(this,ts.Qa,e),this.size=t}function ls(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return In.setTimeout((function(){e()}),t)}ts.Pa="serverreachability",Pn(ss,Mn),ts.STAT_EVENT="statevent",Pn(os,Mn),ts.Qa="timingevent",Pn(hs,Mn);var cs={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},us={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function ds(){}function ps(e){return e.h||(e.h=e.i())}function fs(){}ds.prototype.h=null;var gs,ms={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function _s(){Mn.call(this,"d")}function ys(){Mn.call(this,"c")}function vs(){}function ws(e,t,n,i){this.l=e,this.j=t,this.m=n,this.U=i||1,this.S=new Yi(this),this.O=bs,e=Yn?125:void 0,this.T=new Wi(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Is}function Is(){this.i=null,this.g="",this.h=!1}Pn(_s,Mn),Pn(ys,Mn),Pn(vs,ds),vs.prototype.g=function(){return new XMLHttpRequest},vs.prototype.i=function(){return{}},gs=new vs;var bs=45e3,Ts={},Es={};function Cs(e,t,n){e.K=1,e.v=Ws(js(t)),e.s=n,e.P=!0,ks(e,null)}function ks(e,t){e.F=Date.now(),As(e),e.A=js(e.v);var n=e.A,i=e.U;Array.isArray(i)||(i=[String(i)]),ir(n.i,"t",i),e.C=0,n=e.l.H,e.h=new Is,e.g=no(e.l,n?t:null,!e.s),0<e.N&&(e.L=new Gi(Nn(e.La,e,e.g),e.N)),Ji(e.S,e.g,"readystatechange",e.ib),t=e.H?pi(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),rs(),function(e,t,n,i,s,r){e.info((function(){if(e.g)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var l=a[h].split("=");if(1<l.length){var c=l[0];l=l[1];var u=c.split("_");o=2<=u.length&&"type"==u[1]?o+(c+"=")+l+"&":o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function Ss(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Da}function Rs(e,t,n){let i,s=!0;for(;!e.I&&e.C<n.length;){if(i=Ns(e,n),i==Es){4==t&&(e.o=4,as(14),s=!1),es(e.j,e.m,null,"[Incomplete Response]");break}if(i==Ts){e.o=4,as(15),es(e.j,e.m,n,"[Invalid Chunk]"),s=!1;break}es(e.j,e.m,i,null),xs(e,i)}Ss(e)&&i!=Es&&i!=Ts&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,as(16),s=!1),e.i=e.i&&s,s?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Gr(t),t.K=!0,as(11))):(es(e.j,e.m,n,"[Invalid Chunked Response]"),Ls(e),Ds(e))}function Ns(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?Es:(n=Number(t.substring(n,i)),isNaN(n)?Ts:(i+=1)+n>t.length?Es:(t=t.substr(i,n),e.C=i+n,t))}function As(e){e.V=Date.now()+e.O,Ps(e,e.O)}function Ps(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ls(Nn(e.gb,e),t)}function Os(e){e.B&&(In.clearTimeout(e.B),e.B=null)}function Ds(e){0==e.l.G||e.I||Jr(e.l,e)}function Ls(e){Os(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,zi(e.T),Qi(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function xs(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||lr(n.h,e)))if(!e.J&&lr(n.h,e)&&3==n.G){try{var i=n.Fa.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Xr(n),qr(n)}Kr(n),as(18)}}else n.Ba=s[1],0<n.Ba-n.T&&37500>s[2]&&n.L&&0==n.A&&!n.v&&(n.v=ls(Nn(n.cb,n),6e3));if(1>=hr(n.h)&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else Zr(n,11)}else if((e.J||n.g==e)&&Xr(n),!Un(t))for(s=n.Fa.g.parse(t),t=0;t<s.length;t++){let l=s[t];if(n.T=l[0],l=l[1],2==n.G)if("c"==l[0]){n.I=l[1],n.ka=l[2];const t=l[3];null!=t&&(n.ma=t,n.j.info("VER="+n.ma));const s=l[4];null!=s&&(n.Ca=s,n.j.info("SVER="+n.Ca));const c=l[5];null!=c&&"number"==typeof c&&0<c&&(i=1.5*c,n.J=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(cr(r,r.h),r.h=null))}if(i.D){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.za=e,Vs(i.F,i.D,e))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var o=e;if((i=n).sa=to(i,i.H?i.ka:null,i.V),o.J){ur(i.h,o);var a=o,h=i.J;h&&a.setTimeout(h),a.B&&(Os(a),As(a)),i.g=o}else $r(i);0<n.i.length&&Br(n)}else"stop"!=l[0]&&"close"!=l[0]||Zr(n,7);else 3==n.G&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?Zr(n,7):jr(n):"noop"!=l[0]&&n.l&&n.l.wa(l),n.A=0)}rs()}catch(e){}}function Ms(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Tn(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Tn(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Tn(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),s=i.length,r=0;r<s;r++)t.call(void 0,i[r],n&&n[r],e)}(_n=ws.prototype).setTimeout=function(e){this.O=e},_n.ib=function(e){e=e.target;const t=this.L;t&&3==Dr(e)?t.l():this.La(e)},_n.La=function(e){try{if(e==this.g)e:{const c=Dr(this.g);var t=this.g.Ea();if(this.g.aa(),!(3>c)&&(3!=c||Yn||this.g&&(this.h.h||this.g.fa()||Lr(this.g)))){this.I||4!=c||7==t||rs(),Os(this);var n=this.g.aa();this.Y=n;t:if(Ss(this)){var i=Lr(this.g);e="";var s=i.length,r=4==Dr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ls(this),Ds(this);var o="";break t}this.h.i=new In.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:r&&t==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==n,function(e,t,n,i,s,r,o){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.U,c,n),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,h=this.g;if((a=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Un(a)){var l=a;break t}}l=null}if(!(n=l)){this.i=!1,this.o=3,as(12),Ls(this),Ds(this);break e}es(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,xs(this,n)}this.P?(Rs(this,c,o),Yn&&this.i&&3==c&&(Ji(this.S,this.T,"tick",this.hb),this.T.start())):(es(this.j,this.m,o,null),xs(this,o)),4==c&&Ls(this),this.i&&!this.I&&(4==c?Jr(this.l,this):(this.i=!1,As(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,as(12)):(this.o=0,as(13)),Ls(this),Ds(this)}}}catch(e){}},_n.hb=function(){if(this.g){var e=Dr(this.g),t=this.g.fa();this.C<t.length&&(Os(this),Rs(this,e,t),this.i&&4!=e&&As(this))}},_n.cancel=function(){this.I=!0,Ls(this)},_n.gb=function(){this.B=null;const e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(rs(),as(17)),Ls(this),this.o=2,Ds(this)):Ps(this,this.V-e)};var Fs=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Us(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Us){this.h=void 0!==t?t:e.h,qs(this,e.j),this.s=e.s,this.g=e.g,Hs(this,e.m),this.l=e.l,t=e.i;var n=new Zs;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Bs(this,n),this.o=e.o}else e&&(n=String(e).match(Fs))?(this.h=!!t,qs(this,n[1]||"",!0),this.s=zs(n[2]||""),this.g=zs(n[3]||"",!0),Hs(this,n[4]),this.l=zs(n[5]||"",!0),Bs(this,n[6]||"",!0),this.o=zs(n[7]||"")):(this.h=!!t,this.i=new Zs(null,this.h))}function js(e){return new Us(e)}function qs(e,t,n){e.j=n?zs(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Hs(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Bs(e,t,n){t instanceof Zs?(e.i=t,function(e,t){t&&!e.j&&(er(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(tr(this,t),ir(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=$s(t,Js)),e.i=new Zs(t,e.h))}function Vs(e,t,n){e.i.set(t,n)}function Ws(e){return Vs(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function zs(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function $s(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Ks),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Ks(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Us.prototype.toString=function(){var e=[],t=this.j;t&&e.push($s(t,Gs,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push($s(t,Gs,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push($s(n,"/"==n.charAt(0)?Xs:Ys,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",$s(n,Qs)),e.join("")};var Gs=/[#\/\?@]/g,Ys=/[#\?:]/g,Xs=/[#\?]/g,Js=/[#\?@]/g,Qs=/#/g;function Zs(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function er(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),s=null;if(0<=i){var r=e[n].substring(0,i);s=e[n].substring(i+1)}else r=e[n];t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function tr(e,t){er(e),t=sr(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function nr(e,t){return er(e),t=sr(e,t),e.g.has(t)}function ir(e,t,n){tr(e,t),0<n.length&&(e.i=null,e.g.set(sr(e,t),Ln(n)),e.h+=n.length)}function sr(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function rr(e){this.l=e||or,e=In.PerformanceNavigationTiming?0<(e=In.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(In.g&&In.g.Ga&&In.g.Ga()&&In.g.Ga().$b),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(_n=Zs.prototype).add=function(e,t){er(this),this.i=null,e=sr(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},_n.forEach=function(e,t){er(this),this.g.forEach((function(n,i){n.forEach((function(n){e.call(t,n,i,this)}),this)}),this)},_n.oa=function(){er(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const s=e[i];for(let e=0;e<s.length;e++)n.push(t[i])}return n},_n.W=function(e){er(this);let t=[];if("string"==typeof e)nr(this,e)&&(t=t.concat(this.g.get(sr(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},_n.set=function(e,t){return er(this),this.i=null,nr(this,e=sr(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},_n.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},_n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const r=encodeURIComponent(String(i)),o=this.W(i);for(i=0;i<o.length;i++){var s=r;""!==o[i]&&(s+="="+encodeURIComponent(String(o[i]))),e.push(s)}}return this.i=e.join("&")};var or=10;function ar(e){return!!e.h||!!e.g&&e.g.size>=e.j}function hr(e){return e.h?1:e.g?e.g.size:0}function lr(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function cr(e,t){e.g?e.g.add(t):e.h=t}function ur(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function dr(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return Ln(e.i)}function pr(){}function fr(){this.g=new pr}function gr(e,t,n){const i=n||"";try{Ms(e,(function(e,n){let s=e;En(e)&&(s=Li(e)),t.push(i+n+"="+encodeURIComponent(s))}))}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}function mr(e,t,n,i,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(i)}catch(e){}}function _r(e){this.l=e.ac||null,this.j=e.jb||!1}function yr(e,t){Pi.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=vr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}rr.prototype.cancel=function(){if(this.i=dr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},pr.prototype.stringify=function(e){return In.JSON.stringify(e,void 0)},pr.prototype.parse=function(e){return In.JSON.parse(e,void 0)},Pn(_r,ds),_r.prototype.g=function(){return new yr(this.l,this.j)},_r.prototype.i=function(e){return function(){return e}}({}),Pn(yr,Pi);var vr=0;function wr(e){e.j.read().then(e.Ta.bind(e)).catch(e.ga.bind(e))}function Ir(e){e.readyState=4,e.l=null,e.j=null,e.A=null,br(e)}function br(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(_n=yr.prototype).open=function(e,t){if(this.readyState!=vr)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,br(this)},_n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||In).fetch(new Request(this.B,t)).then(this.Wa.bind(this),this.ga.bind(this))},_n.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ir(this)),this.readyState=vr},_n.Wa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,br(this)),this.g&&(this.readyState=3,br(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==In.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;wr(this)}else e.text().then(this.Va.bind(this),this.ga.bind(this))},_n.Ta=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ir(this):br(this),3==this.readyState&&wr(this)}},_n.Va=function(e){this.g&&(this.response=this.responseText=e,Ir(this))},_n.Ua=function(e){this.g&&(this.response=e,Ir(this))},_n.ga=function(){this.g&&Ir(this)},_n.setRequestHeader=function(e,t){this.v.append(e,t)},_n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},_n.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(yr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Tr=In.JSON.parse;function Er(e){Pi.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Cr,this.K=this.L=!1}Pn(Er,Pi);var Cr="",kr=/^https?$/i,Sr=["POST","PUT"];function Rr(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Nr(e),Pr(e)}function Nr(e){e.D||(e.D=!0,Oi(e,"complete"),Oi(e,"error"))}function Ar(e){if(e.h&&void 0!==wn&&(!e.C[1]||4!=Dr(e)||2!=e.aa()))if(e.v&&4==Dr(e))$i(e.Ha,0,e);else if(Oi(e,"readystatechange"),4==Dr(e)){e.h=!1;try{const a=e.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===a){var s=String(e.H).match(Fs)[1]||null;if(!s&&In.self&&In.self.location){var r=In.self.location.protocol;s=r.substr(0,r.length-1)}i=!kr.test(s?s.toLowerCase():"")}n=i}if(n)Oi(e,"complete"),Oi(e,"success");else{e.m=6;try{var o=2<Dr(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",Nr(e)}}finally{Pr(e)}}}function Pr(e,t){if(e.g){Or(e);const n=e.g,i=e.C[0]?bn:null;e.g=null,e.C=null,t||Oi(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function Or(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(In.clearTimeout(e.A),e.A=null)}function Dr(e){return e.g?e.g.readyState:0}function Lr(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Cr:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function xr(e){let t="";return di(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Mr(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=xr(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Vs(e,t,n))}function Fr(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ur(e){this.Ca=0,this.i=[],this.j=new Zi,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Fr("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Fr("baseRetryDelayMs",5e3,e),this.bb=Fr("retryDelaySeedMs",1e4,e),this.$a=Fr("forwardChannelMaxRetries",2,e),this.ta=Fr("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Zb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new rr(e&&e.concurrentRequestLimit),this.Fa=new fr,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=e&&e.Xb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function jr(e){if(Hr(e),3==e.G){var t=e.U++,n=js(e.F);Vs(n,"SID",e.I),Vs(n,"RID",t),Vs(n,"TYPE","terminate"),Wr(e,n),(t=new ws(e,e.j,t,void 0)).K=2,t.v=Ws(js(n)),n=!1,In.navigator&&In.navigator.sendBeacon&&(n=In.navigator.sendBeacon(t.v.toString(),"")),!n&&In.Image&&((new Image).src=t.v,n=!0),n||(t.g=no(t.l,null),t.g.da(t.v)),t.F=Date.now(),As(t)}eo(e)}function qr(e){e.g&&(Gr(e),e.g.cancel(),e.g=null)}function Hr(e){qr(e),e.u&&(In.clearTimeout(e.u),e.u=null),Xr(e),e.h.cancel(),e.m&&("number"==typeof e.m&&In.clearTimeout(e.m),e.m=null)}function Br(e){ar(e.h)||e.m||(e.m=!0,qi(e.Ja,e),e.C=0)}function Vr(e,t){var n;n=t?t.m:e.U++;const i=js(e.F);Vs(i,"SID",e.I),Vs(i,"RID",n),Vs(i,"AID",e.T),Wr(e,i),e.o&&e.s&&Mr(i,e.o,e.s),n=new ws(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=zr(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),cr(e.h,n),Cs(n,i,t)}function Wr(e,t){e.ia&&di(e.ia,(function(e,n){Vs(t,n,e)})),e.l&&Ms({},(function(e,n){Vs(t,n,e)}))}function zr(e,t,n){n=Math.min(e.i.length,n);var i=e.l?Nn(e.l.Ra,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let r=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=t,0>n)t=Math.max(0,s[o].h-100),r=!1;else try{gr(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(r){i=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function $r(e){e.g||e.u||(e.Z=1,qi(e.Ia,e),e.A=0)}function Kr(e){return!(e.g||e.u||3<=e.A||(e.Z++,e.u=ls(Nn(e.Ia,e),Qr(e,e.A)),e.A++,0))}function Gr(e){null!=e.B&&(In.clearTimeout(e.B),e.B=null)}function Yr(e){e.g=new ws(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=js(e.sa);Vs(t,"RID","rpc"),Vs(t,"SID",e.I),Vs(t,"CI",e.L?"0":"1"),Vs(t,"AID",e.T),Vs(t,"TYPE","xmlhttp"),Wr(e,t),e.o&&e.s&&Mr(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Ws(js(t)),n.s=null,n.P=!0,ks(n,e)}function Xr(e){null!=e.v&&(In.clearTimeout(e.v),e.v=null)}function Jr(e,t){var n=null;if(e.g==t){Xr(e),Gr(e),e.g=null;var i=2}else{if(!lr(e.h,t))return;n=t.D,ur(e.h,t),i=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.F;var s=e.C;Oi(i=is(),new hs(i,n)),Br(e)}else $r(e);else if(3==(s=t.o)||0==s&&0<e.pa||!(1==i&&function(e,t){return!(hr(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.C>=(e.Za?0:e.$a)||(e.m=ls(Nn(e.Ja,e,t),Qr(e,e.C)),e.C++,0)))}(e,t)||2==i&&Kr(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),s){case 1:Zr(e,5);break;case 4:Zr(e,10);break;case 3:Zr(e,6);break;default:Zr(e,2)}}function Qr(e,t){let n=e.Xa+Math.floor(Math.random()*e.bb);return e.l||(n*=2),n*t}function Zr(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var i=Nn(e.kb,e);n||(n=new Us("//www.google.com/images/cleardot.gif"),In.location&&"http"==In.location.protocol||qs(n,"https"),Ws(n)),function(e,t){const n=new Zi;if(In.Image){const i=new Image;i.onload=An(mr,n,i,"TestLoadImage: loaded",!0,t),i.onerror=An(mr,n,i,"TestLoadImage: error",!1,t),i.onabort=An(mr,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=An(mr,n,i,"TestLoadImage: timeout",!1,t),In.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(n.toString(),i)}else as(2);e.G=0,e.l&&e.l.va(t),eo(e),Hr(e)}function eo(e){if(e.G=0,e.la=[],e.l){const t=dr(e.h);0==t.length&&0==e.i.length||(xn(e.la,t),xn(e.la,e.i),e.h.i.length=0,Ln(e.i),e.i.length=0),e.l.ua()}}function to(e,t,n){var i=n instanceof Us?js(n):new Us(n,void 0);if(""!=i.g)t&&(i.g=t+"."+i.g),Hs(i,i.m);else{var s=In.location;i=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var r=new Us(null,void 0);i&&qs(r,i),t&&(r.g=t),s&&Hs(r,s),n&&(r.l=n),i=r}return n=e.D,t=e.za,n&&t&&Vs(i,n,t),Vs(i,"VER",e.ma),Wr(e,i),i}function no(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new Er(new _r({jb:!0})):new Er(e.ra)).Ka(e.H),t}function io(){}function so(){if(Kn&&!(10<=Number(ri)))throw Error("Environmental error: no available transport.")}function ro(e,t){Pi.call(this),this.g=new Ur(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Yb)&&!Un(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Un(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new ho(this)}function oo(e){_s.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ao(){ys.call(this),this.status=1}function ho(e){this.g=e}(_n=Er.prototype).Ka=function(e){this.L=e},_n.da=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():gs.g(),this.C=this.u?ps(this.u):ps(gs),this.g.onreadystatechange=Nn(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Rr(this,e)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=In.FormData&&e instanceof In.FormData,!(0<=Dn(Sr,t))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Or(this),0<this.B&&((this.K=function(e){return Kn&&si()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Nn(this.qa,this)):this.A=$i(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Rr(this,e)}},_n.qa=function(){void 0!==wn&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Oi(this,"timeout"),this.abort(8))},_n.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Oi(this,"complete"),Oi(this,"abort"),Pr(this))},_n.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Pr(this,!0)),Er.X.M.call(this)},_n.Ha=function(){this.s||(this.F||this.v||this.l?Ar(this):this.fb())},_n.fb=function(){Ar(this)},_n.aa=function(){try{return 2<Dr(this)?this.g.status:-1}catch(e){return-1}},_n.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},_n.Sa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Tr(t)}},_n.Ea=function(){return this.m},_n.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(_n=Ur.prototype).ma=8,_n.G=1,_n.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new ws(this,this.j,e,void 0);let r=this.s;if(this.S&&(r?(r=pi(r),gi(r,this.S)):r=this.S),null!==this.o||this.N||(s.H=r,r=null),this.O)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=zr(this,s,t),Vs(n=js(this.F),"RID",e),Vs(n,"CVER",22),this.D&&Vs(n,"X-HTTP-Session-Id",this.D),Wr(this,n),r&&(this.N?t="headers="+encodeURIComponent(String(xr(r)))+"&"+t:this.o&&Mr(n,this.o,r)),cr(this.h,s),this.Ya&&Vs(n,"TYPE","init"),this.O?(Vs(n,"$req",t),Vs(n,"SID","null"),s.Z=!0,Cs(s,n,null)):Cs(s,n,t),this.G=2}}else 3==this.G&&(e?Vr(this,e):0==this.i.length||ar(this.h)||Vr(this))},_n.Ia=function(){if(this.u=null,Yr(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=ls(Nn(this.eb,this),e)}},_n.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,as(10),qr(this),Yr(this))},_n.cb=function(){null!=this.v&&(this.v=null,qr(this),Kr(this),as(19))},_n.kb=function(e){e?(this.j.info("Successfully pinged google.com"),as(2)):(this.j.info("Failed to ping google.com"),as(1))},(_n=io.prototype).xa=function(){},_n.wa=function(){},_n.va=function(){},_n.ua=function(){},_n.Ra=function(){},so.prototype.g=function(e,t){return new ro(e,t)},Pn(ro,Pi),ro.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;as(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=to(e,null,e.V),Br(e)},ro.prototype.close=function(){jr(this.g)},ro.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Li(e),e=n);t.i.push(new class{constructor(e,t){this.h=e,this.g=t}}(t.ab++,e)),3==t.G&&Br(t)},ro.prototype.M=function(){this.g.l=null,delete this.j,jr(this.g),delete this.g,ro.X.M.call(this)},Pn(oo,_s),Pn(ao,ys),Pn(ho,io),ho.prototype.xa=function(){Oi(this.g,"a")},ho.prototype.wa=function(e){Oi(this.g,new oo(e))},ho.prototype.va=function(e){Oi(this.g,new ao)},ho.prototype.ua=function(){Oi(this.g,"b")},so.prototype.createWebChannel=so.prototype.g,ro.prototype.send=ro.prototype.u,ro.prototype.open=ro.prototype.m,ro.prototype.close=ro.prototype.close,cs.NO_ERROR=0,cs.TIMEOUT=8,cs.HTTP_ERROR=6,us.COMPLETE="complete",fs.EventType=ms,ms.OPEN="a",ms.CLOSE="b",ms.ERROR="c",ms.MESSAGE="d",Pi.prototype.listen=Pi.prototype.N,Er.prototype.listenOnce=Er.prototype.O,Er.prototype.getLastError=Er.prototype.Oa,Er.prototype.getLastErrorCode=Er.prototype.Ea,Er.prototype.getStatus=Er.prototype.aa,Er.prototype.getResponseJson=Er.prototype.Sa,Er.prototype.getResponseText=Er.prototype.fa,Er.prototype.send=Er.prototype.da,Er.prototype.setWithCredentials=Er.prototype.Ka,vn.createWebChannelTransport=function(){return new so},vn.getStatEventTarget=function(){return is()},vn.ErrorCode=cs,vn.EventType=us,vn.Event=ts,vn.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},vn.FetchXmlHttpFactory=_r,vn.WebChannel=fs,vn.XhrIo=Er;const lo="@firebase/firestore";class co{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}co.UNAUTHENTICATED=new co(null),co.GOOGLE_CREDENTIALS=new co("google-credentials-uid"),co.FIRST_PARTY=new co("first-party-uid"),co.MOCK_USER=new co("mock-user");let uo="9.18.0";const po=new oe("@firebase/firestore");function fo(e,...t){if(po.logLevel<=ee.DEBUG){const n=t.map(mo);po.debug(`Firestore (${uo}): ${e}`,...n)}}function go(e,...t){if(po.logLevel<=ee.ERROR){const n=t.map(mo);po.error(`Firestore (${uo}): ${e}`,...n)}}function mo(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function _o(e="Unexpected state"){const t=`FIRESTORE (${uo}) INTERNAL ASSERTION FAILED: `+e;throw go(t),new Error(t)}function yo(e,t){e||_o()}const vo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class wo extends E{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Io{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class bo{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class To{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(co.UNAUTHENTICATED)))}shutdown(){}}class Eo{constructor(e){this.t=e,this.currentUser=co.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new Io;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Io,e.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},o=e=>{fo("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(fo("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Io)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(fo("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(yo("string"==typeof t.accessToken),new bo(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return yo(null===e||"string"==typeof e),new co(e)}}class Co{constructor(e,t,n,i){this.h=e,this.l=t,this.m=n,this.g=i,this.type="FirstParty",this.user=co.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(yo(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class ko{constructor(e,t,n,i){this.h=e,this.l=t,this.m=n,this.g=i}getToken(){return Promise.resolve(new Co(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable((()=>t(co.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class So{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ro{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const n=e=>{null!=e.error&&fo("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.A;return this.A=e.token,fo("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{fo("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.T.getImmediate({optional:!0});e?i(e):fo("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(yo("string"==typeof e.token),this.A=e.token,new So(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function No(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class Ao{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const i=No(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%e.length))}return n}}function Po(e,t){return e<t?-1:e>t?1:0}class Oo{constructor(e,t,n){void 0===t?t=0:t>e.length&&_o(),void 0===n?n=e.length-t:n>e.length-t&&_o(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Oo.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Oo?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),s=t.get(i);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Do extends Oo{construct(e,t,n){return new Do(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new wo(vo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Do(t)}static emptyPath(){return new Do([])}}class Lo{constructor(e){this.path=e}static fromPath(e){return new Lo(Do.fromString(e))}static fromName(e){return new Lo(Do.fromString(e).popFirst(5))}static empty(){return new Lo(Do.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Do.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Do.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Lo(new Do(e.slice()))}}function xo(e){return"IndexedDbTransactionError"===e.name}class Mo{constructor(e,t,n,i,s,r,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Fo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Fo("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Fo&&e.projectId===this.projectId&&e.database===this.database}}class Uo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class jo{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw e instanceof DOMException?new Uo("Invalid base64 string: "+e):e}}(e);return new jo(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new jo(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Po(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function qo(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}jo.EMPTY_BYTE_STRING=new jo("");class Ho{constructor(e,t){this.comparator=e,this.root=t||Vo.EMPTY}insert(e,t){return new Ho(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vo.BLACK,null,null))}remove(e){return new Ho(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Bo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Bo(this.root,e,this.comparator,!1)}getReverseIterator(){return new Bo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Bo(this.root,e,this.comparator,!0)}}class Bo{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Vo{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Vo.RED,this.left=null!=i?i:Vo.EMPTY,this.right=null!=s?s:Vo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new Vo(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Vo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Vo.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Vo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Vo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw _o();if(this.right.isRed())throw _o();const e=this.left.check();if(e!==this.right.check())throw _o();return e+(this.isRed()?0:1)}}Vo.EMPTY=null,Vo.RED=!0,Vo.BLACK=!1,Vo.EMPTY=new class{constructor(){this.size=0}get key(){throw _o()}get value(){throw _o()}get color(){throw _o()}get left(){throw _o()}get right(){throw _o()}copy(e,t,n,i,s){return this}insert(e,t,n){return new Vo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Wo{constructor(e){this.comparator=e,this.data=new Ho(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zo(this.data.getIterator())}getIteratorFrom(e){return new zo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Wo))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Wo(this.comparator);return t.data=e,t}}class zo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}var $o,Ko;(Ko=$o||($o={}))[Ko.OK=0]="OK",Ko[Ko.CANCELLED=1]="CANCELLED",Ko[Ko.UNKNOWN=2]="UNKNOWN",Ko[Ko.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ko[Ko.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ko[Ko.NOT_FOUND=5]="NOT_FOUND",Ko[Ko.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ko[Ko.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ko[Ko.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ko[Ko.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ko[Ko.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ko[Ko.ABORTED=10]="ABORTED",Ko[Ko.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ko[Ko.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ko[Ko.INTERNAL=13]="INTERNAL",Ko[Ko.UNAVAILABLE=14]="UNAVAILABLE",Ko[Ko.DATA_LOSS=15]="DATA_LOSS",new Ho(Lo.comparator),new Ho(Lo.comparator),new Ho(Lo.comparator),new Wo(Lo.comparator),new Wo(Po);class Go{constructor(){}ae(e,t){this.he(e,t),t.le()}he(e,t){if("nullValue"in e)this.fe(t,5);else if("booleanValue"in e)this.fe(t,10),t.de(e.booleanValue?1:0);else if("integerValue"in e)this.fe(t,15),t.de(qo(e.integerValue));else if("doubleValue"in e){const n=qo(e.doubleValue);isNaN(n)?this.fe(t,13):(this.fe(t,15),function(e){return 0===e&&1/e==-1/0}(n)?t.de(0):t.de(n))}else if("timestampValue"in e){const n=e.timestampValue;this.fe(t,20),"string"==typeof n?t._e(n):(t._e(`${n.seconds||""}`),t.de(n.nanos||0))}else if("stringValue"in e)this.we(e.stringValue,t),this.me(t);else if("bytesValue"in e)this.fe(t,30),t.ge(function(e){return"string"==typeof e?jo.fromBase64String(e):jo.fromUint8Array(e)}(e.bytesValue)),this.me(t);else if("referenceValue"in e)this.ye(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.fe(t,45),t.de(n.latitude||0),t.de(n.longitude||0)}else"mapValue"in e?function(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}(e)?this.fe(t,Number.MAX_SAFE_INTEGER):(this.pe(e.mapValue,t),this.me(t)):"arrayValue"in e?(this.Ie(e.arrayValue,t),this.me(t)):_o()}we(e,t){this.fe(t,25),this.Te(e,t)}Te(e,t){t._e(e)}pe(e,t){const n=e.fields||{};this.fe(t,55);for(const e of Object.keys(n))this.we(e,t),this.he(n[e],t)}Ie(e,t){const n=e.values||[];this.fe(t,50);for(const e of n)this.he(e,t)}ye(e,t){this.fe(t,37),Lo.fromName(e).path.forEach((e=>{this.fe(t,60),this.Te(e,t)}))}fe(e,t){e.de(t)}me(e){e.de(2)}}Go.Ee=new Go,new Uint8Array(0);class Yo{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Yo(e,Yo.DEFAULT_COLLECTION_PERCENTILE,Yo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Xo(){return"undefined"!=typeof document?document:null}Yo.DEFAULT_COLLECTION_PERCENTILE=10,Yo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Yo.DEFAULT=new Yo(41943040,Yo.DEFAULT_COLLECTION_PERCENTILE,Yo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Yo.DISABLED=new Yo(-1,0,0);class Jo{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Ys=e,this.timerId=t,this.po=n,this.Io=i,this.To=s,this.Eo=0,this.Ao=null,this.Ro=Date.now(),this.reset()}reset(){this.Eo=0}Po(){this.Eo=this.To}vo(e){this.cancel();const t=Math.floor(this.Eo+this.bo()),n=Math.max(0,Date.now()-this.Ro),i=Math.max(0,t-n);i>0&&fo("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Eo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ao=this.Ys.enqueueAfterDelay(this.timerId,i,(()=>(this.Ro=Date.now(),e()))),this.Eo*=this.Io,this.Eo<this.po&&(this.Eo=this.po),this.Eo>this.To&&(this.Eo=this.To)}Vo(){null!==this.Ao&&(this.Ao.skipDelay(),this.Ao=null)}cancel(){null!==this.Ao&&(this.Ao.cancel(),this.Ao=null)}bo(){return(Math.random()-.5)*this.Eo}}class Qo{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Io,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,o=new Qo(e,t,r,i,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new wo(vo.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class Zo{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=co.UNAUTHENTICATED,this.clientId=Ao.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{fo("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(fo("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new wo(vo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Io;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=function(e,t){if(go("AsyncQueue",`${t}: ${e}`),xo(e))return new wo(vo.UNAVAILABLE,`${t}: ${e}`);throw e}(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}const ea=new Map;class ta{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new wo(vo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new wo(vo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(e,t,n,i){if(!0===t&&!0===i)throw new wo(vo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class na{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ta({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new wo(vo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new wo(vo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ta(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new To;switch(e.type){case"gapi":const t=e.client;return new ko(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new wo(vo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ea.get(e);t&&(fo("ComponentProvider","Removing Datastore"),ea.delete(e),t.terminate())}(this),Promise.resolve()}}class ia{constructor(){this.qc=Promise.resolve(),this.Uc=[],this.Kc=!1,this.Gc=[],this.Qc=null,this.jc=!1,this.zc=!1,this.Wc=[],this.ko=new Jo(this,"async_queue_retry"),this.Hc=()=>{const e=Xo();e&&fo("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ko.Vo()};const e=Xo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Hc)}get isShuttingDown(){return this.Kc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Jc(),this.Yc(e)}enterRestrictedMode(e){if(!this.Kc){this.Kc=!0,this.zc=e||!1;const t=Xo();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Hc)}}enqueue(e){if(this.Jc(),this.Kc)return new Promise((()=>{}));const t=new Io;return this.Yc((()=>this.Kc&&this.zc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Uc.push(e),this.Zc())))}async Zc(){if(0!==this.Uc.length){try{await this.Uc[0](),this.Uc.shift(),this.ko.reset()}catch(e){if(!xo(e))throw e;fo("AsyncQueue","Operation failed with retryable error: "+e)}this.Uc.length>0&&this.ko.vo((()=>this.Zc()))}}Yc(e){const t=this.qc.then((()=>(this.jc=!0,e().catch((e=>{this.Qc=e,this.jc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw go("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.jc=!1,e))))));return this.qc=t,t}enqueueAfterDelay(e,t,n){this.Jc(),this.Wc.indexOf(e)>-1&&(t=0);const i=Qo.createAndSchedule(this,e,t,n,(e=>this.Xc(e)));return this.Gc.push(i),i}Jc(){this.Qc&&_o()}verifyOperationInProgress(){}async ta(){let e;do{e=this.qc,await e}while(e!==this.qc)}ea(e){for(const t of this.Gc)if(t.timerId===e)return!0;return!1}na(e){return this.ta().then((()=>{this.Gc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Gc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ta()}))}sa(e){this.Wc.push(e)}Xc(e){const t=this.Gc.indexOf(e);this.Gc.splice(t,1)}}class sa extends na{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new ia,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||function(e){var t;const n=e._freezeSettings(),i=function(e,t,n,i){return new Mo(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Zo(e._authCredentials,e._appCheckCredentials,e._queue,i)}(this),this._firestoreClient.terminate()}}!function(e,t=!0){!function(e){uo=e}(Ue),Le(new Y("firestore",((e,{instanceIdentifier:n,options:i})=>{const s=e.getProvider("app").getImmediate(),r=new sa(new Eo(e.getProvider("auth-internal")),new Ro(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new wo(vo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fo(e.options.projectId,t)}(s,n),s);return i=Object.assign({useFetchStreams:t},i),r._setSettings(i),r}),"PUBLIC").setMultipleInstances(!0)),He(lo,"3.9.0",e),He(lo,"3.9.0","esm2017")}();const ra="@firebase/database",oa="0.14.4";let aa="";class ha{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),R(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:S(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class la{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return A(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const ca=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new ha(t)}}catch(e){}return new la},ua=ca("localStorage"),da=ca("sessionStorage"),pa=new oe("@firebase/database"),fa=function(){let e=1;return function(){return e++}}(),ga=function(e){const t=function(e){const t=[];let i=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);if(r>=55296&&r<=56319){const t=r-55296;s++,n(s<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(s)-56320)}r<128?t[i++]=r:r<2048?(t[i++]=r>>6|192,t[i++]=63&r|128):r<65536?(t[i++]=r>>12|224,t[i++]=r>>6&63|128,t[i++]=63&r|128):(t[i++]=r>>18|240,t[i++]=r>>12&63|128,t[i++]=r>>6&63|128,t[i++]=63&r|128)}return t}(e),i=new j;i.update(t);const s=i.digest();return r.encodeByteArray(s)},ma=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=ma.apply(null,i):t+="object"==typeof i?R(i):i,t+=" "}return t};let _a=null,ya=!0;const va=function(...e){if(!0===ya&&(ya=!1,null===_a&&!0===da.get("logging_enabled")&&(t=!0,n(!i||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(pa.logLevel=ee.VERBOSE,_a=pa.log.bind(pa),i&&da.set("logging_enabled",!0)):"function"==typeof t?_a=t:(_a=null,da.remove("logging_enabled")))),_a){const t=ma.apply(null,e);_a(t)}var t,i},wa=function(e){return function(...t){va(e,...t)}},Ia=function(...e){const t="FIREBASE INTERNAL ERROR: "+ma(...e);pa.error(t)},ba=function(...e){const t=`FIREBASE FATAL ERROR: ${ma(...e)}`;throw pa.error(t),new Error(t)},Ta=function(...e){const t="FIREBASE WARNING: "+ma(...e);pa.warn(t)},Ea=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Ca="[MIN_NAME]",ka="[MAX_NAME]",Sa=function(e,t){if(e===t)return 0;if(e===Ca||t===ka)return-1;if(t===Ca||e===ka)return 1;{const n=xa(e),i=xa(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},Ra=function(e,t){return e===t?0:e<t?-1:1},Na=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+R(t))},Aa=function(e){if("object"!=typeof e||null===e)return R(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=R(t[i]),n+=":",n+=Aa(e[t[i]]);return n+="}",n},Pa=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let s=0;s<n;s+=t)s+t>n?i.push(e.substring(s,n)):i.push(e.substring(s,s+t));return i};function Oa(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Da=function(e){n(!Ea(e),"Invalid JSON number");let t,i,s,r,o;0===e?(i=0,s=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),i=r+1023,s=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(i=0,s=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);a.push(t?1:0),a.reverse();const h=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(h.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},La=new RegExp("^-?(0*)\\d{1,10}$"),xa=function(e){if(La.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Ma=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw Ta("Exception was thrown by user callback.",t),e}),Math.floor(0))}},Fa=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ua=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class ja{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){Ta(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class qa{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(va("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ta(e)}}class Ha{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ha.OWNER="owner";const Ba="5",Va=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Wa="ac",za="websocket",$a="long_polling";class Ka{constructor(e,t,n,i,s=!1,r="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ua.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ua.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Ga(e,t,i){let s;if(n("string"==typeof t,"typeof type must == string"),n("object"==typeof i,"typeof params must == object"),t===za)s=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==$a)throw new Error("Unknown connection type: "+t);s=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(i.ns=e.namespace);const r=[];return Oa(i,((e,t)=>{r.push(e+"="+t)})),s+r.join("&")}class Ya{constructor(){this.counters_={}}incrementCounter(e,t=1){A(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return c(this.counters_)}}const Xa={},Ja={};function Qa(e){const t=e.toString();return Xa[t]||(Xa[t]=new Ya),Xa[t]}class Za{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Ma((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const eh="start";class th{constructor(e,t,n,i,s,r,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wa(e),this.stats_=Qa(t),this.urlFn=e=>(this.appCheckToken&&(e[Wa]=this.appCheckToken),Ga(t,$a,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Za(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(I()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new nh(((...e)=>{const[t,n,i,s,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===eh)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[eh]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Ba,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Wa]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Va.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){th.forceAllow_=!0}static forceDisallow(){th.forceDisallow_=!0}static isAvailable(){return!(I()||!th.forceAllow_&&(th.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=R(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=a(t),i=Pa(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(I())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=R(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class nh{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,I())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=fa(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=nh.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){va("frame writing exception"),e.stack&&va(e.stack),va(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||va("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){I()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{va("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let ih=null;"undefined"!=typeof MozWebSocket?ih=MozWebSocket:"undefined"!=typeof WebSocket&&(ih=WebSocket);class sh{constructor(e,t,n,i,s,r,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wa(this.connId),this.stats_=Qa(t),this.connURL=sh.connectionURL_(t,r,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,s){const r={};return r.v=Ba,!I()&&"undefined"!=typeof location&&location.hostname&&Va.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),i&&(r[Wa]=i),s&&(r.p=s),Ga(e,za,r)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ua.set("previous_websocket_failure",!0);try{let e;if(I()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${Ba}/${aa}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n=process.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new ih(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){sh.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==ih&&!sh.forceDisallow_}static previouslyFailed(){return ua.isInMemoryStorage||!0===ua.get("previous_websocket_failure")}markConnectionHealthy(){ua.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=S(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(n(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=R(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Pa(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}sh.responsesRequiredToBeHealthy=2,sh.healthyTimeout=3e4;class rh{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[th,sh]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=sh&&sh.isAvailable();let n=t&&!sh.previouslyFailed();if(e.webSocketOnly&&(t||Ta("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[sh];else{const e=this.transports_=[];for(const t of rh.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);rh.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}rh.globalTransportInitialized_=!1;class oh{constructor(e,t,n,i,s,r,o,a,h,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wa("c:"+this.id+":"),this.transportManager_=new rh(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Ua((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Na("t",e),n=Na("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Na("t",e),n=Na("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Na("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Ia("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ia("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Ba!==n&&Ta("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Ua((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ua((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ua.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ah{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class hh{constructor(e){this.allowedEvents_=e,this.listeners_={},n(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){n(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class lh extends hh{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||y()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new lh}getInitialEvent(e){return n("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const ch=32,uh=768;class dh{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function ph(){return new dh("")}function fh(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function gh(e){return e.pieces_.length-e.pieceNum_}function mh(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new dh(e.pieces_,t)}function _h(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function yh(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function vh(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new dh(t,0)}function wh(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof dh)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new dh(n,0)}function Ih(e){return e.pieceNum_>=e.pieces_.length}function bh(e,t){const n=fh(e),i=fh(t);if(null===n)return t;if(n===i)return bh(mh(e),mh(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Th(e,t){if(gh(e)!==gh(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function Eh(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(gh(e)>gh(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class Ch{constructor(e,t){this.errorPrefix_=t,this.parts_=yh(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=B(this.parts_[e]);kh(this)}}function kh(e){if(e.byteLength_>uh)throw new Error(e.errorPrefix_+"has a key path longer than "+uh+" bytes ("+e.byteLength_+").");if(e.parts_.length>ch)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ch+") or object contains a cycle "+Sh(e))}function Sh(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Rh extends hh{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Rh}getInitialEvent(e){return n("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Nh=1e3;class Ah extends ah{constructor(e,t,n,i,s,r,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Ah.nextPersistentConnectionId_++,this.log_=wa("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Nh,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!I())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Rh.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&lh.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,r={r:s,a:e,b:t};this.log_(R(r)),n(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new m,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),n(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),n(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,(s=>{const r=s.d,o=s.s;Ah.warnOnListenWarnings_(r,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,r))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&A(e,"w")){const n=P(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Ta(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=N(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=N(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),n(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,s){this.initConnection_();const r={p:t,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:e,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+R(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Ia("Unrecognized action received from server: "+R(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){n(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Nh,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Nh,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Nh),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Ah.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const h=function(){a?a.close():(o=!0,i())},l=function(e){n(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:h,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[n,h]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);o?va("getToken() completed but was canceled"):(va("getToken() completed. Creating connection."),this.authToken_=n&&n.accessToken,this.appCheckToken_=h&&h.token,a=new oh(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,(e=>{Ta(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&Ta(e),h())}}}interrupt(e){va("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){va("Resuming connection for reason: "+e),delete this.interruptReasons_[e],O(this.interruptReasons_)&&(this.reconnectDelay_=Nh,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>Aa(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new dh(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){va("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){va("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";I()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+aa.replace(/\./g,"-")]=1,y()?e["framework.cordova"]=1:w()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=lh.getInstance().currentlyOnline();return O(this.interruptReasons_)&&e}}Ah.nextPersistentConnectionId_=0,Ah.nextConnectionId_=0;class Ph{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ph(e,t)}}class Oh{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Ph(Ca,e),i=new Ph(Ca,t);return 0!==this.compare(n,i)}minPost(){return Ph.MIN}}let Dh;class Lh extends Oh{static get __EMPTY_NODE(){return Dh}static set __EMPTY_NODE(e){Dh=e}compare(e,t){return Sa(e.name,t.name)}isDefinedOn(e){throw i("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ph.MIN}maxPost(){return new Ph(ka,Dh)}makePost(e,t){return n("string"==typeof e,"KeyIndex indexValue must always be a string."),new Ph(e,Dh)}toString(){return".key"}}const xh=new Lh;class Mh{constructor(e,t,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,i&&(r*=-1),r<0)e=this.isReverse_?e.left:e.right;else{if(0===r){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Fh{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Fh.RED,this.left=null!=i?i:Uh.EMPTY_NODE,this.right=null!=s?s:Uh.EMPTY_NODE}copy(e,t,n,i,s){return new Fh(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Uh.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Uh.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Fh.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Fh.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Fh.RED=!0,Fh.BLACK=!1;class Uh{constructor(e,t=Uh.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Uh(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Fh.BLACK,null,null))}remove(e){return new Uh(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Fh.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Mh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Mh(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Mh(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Mh(this.root_,null,this.comparator_,!0,e)}}function jh(e,t){return Sa(e.name,t.name)}function qh(e,t){return Sa(e,t)}let Hh;Uh.EMPTY_NODE=new class{copy(e,t,n,i,s){return this}insert(e,t,n){return new Fh(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Bh=function(e){return"number"==typeof e?"number:"+Da(e):"string:"+e},Vh=function(e){if(e.isLeafNode()){const t=e.val();n("string"==typeof t||"number"==typeof t||"object"==typeof t&&A(t,".sv"),"Priority must be a string or number.")}else n(e===Hh||e.isEmpty(),"priority of unexpected type.");n(e===Hh||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Wh,zh,$h;class Kh{constructor(e,t=Kh.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,n(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Vh(this.priorityNode_)}static set __childrenNodeConstructor(e){Wh=e}static get __childrenNodeConstructor(){return Wh}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Kh(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Kh.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ih(e)?this:".priority"===fh(e)?this.priorityNode_:Kh.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Kh.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=fh(e);return null===i?t:t.isEmpty()&&".priority"!==i?this:(n(".priority"!==i||1===gh(e),".priority must be the last token in a path"),this.updateImmediateChild(i,Kh.__childrenNodeConstructor.EMPTY_NODE.updateChild(mh(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Bh(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?Da(this.value_):this.value_,this.lazyHash_=ga(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Kh.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Kh.__childrenNodeConstructor?-1:(n(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=Kh.VALUE_TYPE_ORDER.indexOf(t),r=Kh.VALUE_TYPE_ORDER.indexOf(i);return n(s>=0,"Unknown leaf type: "+t),n(r>=0,"Unknown leaf type: "+i),s===r?"object"===i?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Kh.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Gh=new class extends Oh{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),s=n.compareTo(i);return 0===s?Sa(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ph.MIN}maxPost(){return new Ph(ka,new Kh("[PRIORITY-POST]",$h))}makePost(e,t){const n=zh(e);return new Ph(t,new Kh("[PRIORITY-POST]",n))}toString(){return".priority"}},Yh=Math.log(2);class Xh{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Yh,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Jh=function(e,t,n,i){e.sort(t);const s=function(t,i){const r=i-t;let o,a;if(0===r)return null;if(1===r)return o=e[t],a=n?n(o):o,new Fh(a,o.node,Fh.BLACK,null,null);{const h=parseInt(r/2,10)+t,l=s(t,h),c=s(h+1,i);return o=e[h],a=n?n(o):o,new Fh(a,o.node,Fh.BLACK,l,c)}},r=function(t){let i=null,r=null,o=e.length;const a=function(t,i){const r=o-t,a=o;o-=t;const l=s(r+1,a),c=e[r],u=n?n(c):c;h(new Fh(u,c.node,i,null,l))},h=function(e){i?(i.left=e,i=e):(r=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Fh.BLACK):(a(i,Fh.BLACK),a(i,Fh.RED))}return r}(new Xh(e.length));return new Uh(i||t,r)};let Qh;const Zh={};class el{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return n(Zh&&Gh,"ChildrenNode.ts has not been loaded"),Qh=Qh||new el({".priority":Zh},{".priority":Gh}),Qh}get(e){const t=P(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Uh?t:null}hasIndex(e){return A(this.indexSet_,e.toString())}addIndex(e,t){n(e!==xh,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(Ph.Wrap);let o,a=r.getNext();for(;a;)s=s||e.isDefinedOn(a.node),i.push(a),a=r.getNext();o=s?Jh(i,e.getCompare()):Zh;const h=e.toString(),l=Object.assign({},this.indexSet_);l[h]=e;const c=Object.assign({},this.indexes_);return c[h]=o,new el(c,l)}addToIndexes(e,t){const i=D(this.indexes_,((i,s)=>{const r=P(this.indexSet_,s);if(n(r,"Missing index implementation for "+s),i===Zh){if(r.isDefinedOn(e.node)){const n=[],i=t.getIterator(Ph.Wrap);let s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),Jh(n,r.getCompare())}return Zh}{const n=t.get(e.name);let s=i;return n&&(s=s.remove(new Ph(e.name,n))),s.insert(e,e.node)}}));return new el(i,this.indexSet_)}removeFromIndexes(e,t){const n=D(this.indexes_,(n=>{if(n===Zh)return n;{const i=t.get(e.name);return i?n.remove(new Ph(e.name,i)):n}}));return new el(n,this.indexSet_)}}let tl;class nl{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Vh(this.priorityNode_),this.children_.isEmpty()&&n(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return tl||(tl=new nl(new Uh(qh),null,el.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||tl}updatePriority(e){return this.children_.isEmpty()?this:new nl(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?tl:t}}getChild(e){const t=fh(e);return null===t?this:this.getImmediateChild(t).getChild(mh(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(n(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Ph(e,t);let i,s;t.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(n,this.children_));const r=i.isEmpty()?tl:this.priorityNode_;return new nl(i,r,s)}}updateChild(e,t){const i=fh(e);if(null===i)return t;{n(".priority"!==fh(e)||1===gh(e),".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(mh(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,s=!0;if(this.forEachChild(Gh,((r,o)=>{t[r]=o.val(e),n++,s&&nl.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1})),!e&&s&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Bh(this.getPriority().val())+":"),this.forEachChild(Gh,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":ga(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new Ph(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ph(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ph(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,Ph.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,Ph.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===il?-1:0}withIndex(e){if(e===xh||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new nl(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===xh||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Gh),n=t.getIterator(Gh);let i=e.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=e.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(e){return e===xh?null:this.indexMap_.get(e.toString())}}nl.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const il=new class extends nl{constructor(){super(new Uh(qh),nl.EMPTY_NODE,el.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return nl.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Ph,{MIN:{value:new Ph(Ca,nl.EMPTY_NODE)},MAX:{value:new Ph(ka,il)}}),Lh.__EMPTY_NODE=nl.EMPTY_NODE,Kh.__childrenNodeConstructor=nl,Hh=il,$h=il;const sl=!0;function rl(e,t=null){if(null===e)return nl.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),n(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Kh(e,rl(t));if(e instanceof Array||!sl){let n=nl.EMPTY_NODE;return Oa(e,((t,i)=>{if(A(e,t)&&"."!==t.substring(0,1)){const e=rl(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(rl(t))}{const n=[];let i=!1;if(Oa(e,((e,t)=>{if("."!==e.substring(0,1)){const s=rl(t);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),n.push(new Ph(e,s)))}})),0===n.length)return nl.EMPTY_NODE;const s=Jh(n,jh,(e=>e.name),qh);if(i){const e=Jh(n,Gh.getCompare());return new nl(s,rl(t),new el({".priority":e},{".priority":Gh}))}return new nl(s,rl(t),el.Default)}}!function(e){zh=e}(rl);class ol extends Oh{constructor(e){super(),this.indexPath_=e,n(!Ih(e)&&".priority"!==fh(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),s=n.compareTo(i);return 0===s?Sa(e.name,t.name):s}makePost(e,t){const n=rl(e),i=nl.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ph(t,i)}maxPost(){const e=nl.EMPTY_NODE.updateChild(this.indexPath_,il);return new Ph(ka,e)}toString(){return yh(this.indexPath_,0).join("/")}}const al=new class extends Oh{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Sa(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ph.MIN}maxPost(){return Ph.MAX}makePost(e,t){const n=rl(e);return new Ph(t,n)}toString(){return".value"}};function hl(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ll{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Gh}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return n(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return n(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ca}hasEnd(){return this.endSet_}getIndexEndValue(){return n(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return n(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ka}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return n(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Gh}copy(){const e=new ll;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function cl(e){const t={};if(e.isDefault())return t;let i;if(e.index_===Gh?i="$priority":e.index_===al?i="$value":e.index_===xh?i="$key":(n(e.index_ instanceof ol,"Unrecognized index type!"),i=e.index_.toString()),t.orderBy=R(i),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=R(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+R(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=R(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+R(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function ul(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Gh&&(t.i=e.index_.toString()),t}class dl extends ah{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=wa("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(n(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const r=dl.getListenId_(e,n),o={};this.listens_[r]=o;const a=cl(e._queryParams);this.restRequest_(s+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(s,a,!1,n),P(this.listens_,r)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=dl.getListenId_(e,t);delete this.listens_[n]}get(e){const t=cl(e._queryParams),n=e._path.toString(),i=new m;return this.restRequest_(n+".json",t,((e,t)=>{let s=t;404===e&&(s=null,e=null),null===e?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+M(t);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=S(o.responseText)}catch(e){Ta("Failed to parse JSON response for "+r+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&Ta("Got unsuccessful REST response for "+r+" Status: "+o.status),n(o.status);n=null}},o.open("GET",r,!0),o.send()}))}}class pl{constructor(){this.rootNode_=nl.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function fl(){return{value:null,children:new Map}}function gl(e,t,n){if(Ih(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=fh(t);e.children.has(i)||e.children.set(i,fl()),gl(e.children.get(i),t=mh(t),n)}}function ml(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{ml(i,new dh(t.toString()+"/"+e),n)}))}class _l{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Oa(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class yl{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new _l(e);const n=1e4+2e4*Math.random();Ua(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Oa(e,((e,i)=>{i>0&&A(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),Ua(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var vl;function wl(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(vl||(vl={}));class Il{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=vl.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Ih(this.path)){if(null!=this.affectedTree.value)return n(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new dh(e));return new Il(ph(),t,this.revert)}}return n(fh(this.path)===e,"operationForChild called for unrelated child."),new Il(mh(this.path),this.affectedTree,this.revert)}}class bl{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=vl.OVERWRITE}operationForChild(e){return Ih(this.path)?new bl(this.source,ph(),this.snap.getImmediateChild(e)):new bl(this.source,mh(this.path),this.snap)}}class Tl{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=vl.MERGE}operationForChild(e){if(Ih(this.path)){const t=this.children.subtree(new dh(e));return t.isEmpty()?null:t.value?new bl(this.source,ph(),t.value):new Tl(this.source,ph(),t)}return n(fh(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Tl(this.source,mh(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class El{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ih(e))return this.isFullyInitialized()&&!this.filtered_;const t=fh(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Cl(e,t,n,s,r,o){const a=s.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw i("Should only compare child_ events.");const s=new Ph(t.childName,t.snapshotNode),r=new Ph(n.childName,n.snapshotNode);return e.index_.compare(s,r)}(e,t,n))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);r.forEach((s=>{s.respondsTo(n.type)&&t.push(s.createEvent(i,e.query_))}))}))}function kl(e,t){return{eventCache:e,serverCache:t}}function Sl(e,t,n,i){return kl(new El(t,n,i),e.serverCache)}function Rl(e,t,n,i){return kl(e.eventCache,new El(t,n,i))}function Nl(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Al(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Pl;class Ol{constructor(e,t=(()=>(Pl||(Pl=new Uh(Ra)),Pl))()){this.value=e,this.children=t}static fromObject(e){let t=new Ol(null);return Oa(e,((e,n)=>{t=t.set(new dh(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:ph(),value:this.value};if(Ih(e))return null;{const n=fh(e),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(mh(e),t);return null!=s?{path:wh(new dh(n),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Ih(e))return this;{const t=fh(e),n=this.children.get(t);return null!==n?n.subtree(mh(e)):new Ol(null)}}set(e,t){if(Ih(e))return new Ol(t,this.children);{const n=fh(e),i=(this.children.get(n)||new Ol(null)).set(mh(e),t),s=this.children.insert(n,i);return new Ol(this.value,s)}}remove(e){if(Ih(e))return this.children.isEmpty()?new Ol(null):new Ol(null,this.children);{const t=fh(e),n=this.children.get(t);if(n){const i=n.remove(mh(e));let s;return s=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&s.isEmpty()?new Ol(null):new Ol(this.value,s)}return this}}get(e){if(Ih(e))return this.value;{const t=fh(e),n=this.children.get(t);return n?n.get(mh(e)):null}}setTree(e,t){if(Ih(e))return t;{const n=fh(e),i=(this.children.get(n)||new Ol(null)).setTree(mh(e),t);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new Ol(this.value,s)}}fold(e){return this.fold_(ph(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,s)=>{n[i]=s.fold_(wh(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,ph(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(Ih(e))return null;{const i=fh(e),s=this.children.get(i);return s?s.findOnPath_(mh(e),wh(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ph(),t)}foreachOnPath_(e,t,n){if(Ih(e))return this;{this.value&&n(t,this.value);const i=fh(e),s=this.children.get(i);return s?s.foreachOnPath_(mh(e),wh(t,i),n):new Ol(null)}}foreach(e){this.foreach_(ph(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(wh(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Dl{constructor(e){this.writeTree_=e}static empty(){return new Dl(new Ol(null))}}function Ll(e,t,n){if(Ih(t))return new Dl(new Ol(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const s=i.path;let r=i.value;const o=bh(s,t);return r=r.updateChild(o,n),new Dl(e.writeTree_.set(s,r))}{const i=new Ol(n),s=e.writeTree_.setTree(t,i);return new Dl(s)}}}function xl(e,t,n){let i=e;return Oa(n,((e,n)=>{i=Ll(i,wh(t,e),n)})),i}function Ml(e,t){if(Ih(t))return Dl.empty();{const n=e.writeTree_.setTree(t,new Ol(null));return new Dl(n)}}function Fl(e,t){return null!=Ul(e,t)}function Ul(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(bh(n.path,t)):null}function jl(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Gh,((e,n)=>{t.push(new Ph(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new Ph(e,n.value))})),t}function ql(e,t){if(Ih(t))return e;{const n=Ul(e,t);return new Dl(null!=n?new Ol(n):e.writeTree_.subtree(t))}}function Hl(e){return e.writeTree_.isEmpty()}function Bl(e,t){return Vl(ph(),e.writeTree_,t)}function Vl(e,t,i){if(null!=t.value)return i.updateChild(e,t.value);{let s=null;return t.children.inorderTraversal(((t,r)=>{".priority"===t?(n(null!==r.value,"Priority writes must always be leaf nodes"),s=r.value):i=Vl(wh(e,t),r,i)})),i.getChild(e).isEmpty()||null===s||(i=i.updateChild(wh(e,".priority"),s)),i}}function Wl(e,t){return tc(t,e)}function zl(e,t){if(e.snap)return Eh(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Eh(wh(e.path,n),t))return!0;return!1}function $l(e){return e.visible}function Kl(e,t,n){let s=Dl.empty();for(let r=0;r<e.length;++r){const o=e[r];if(t(o)){const e=o.path;let t;if(o.snap)Eh(n,e)?(t=bh(n,e),s=Ll(s,t,o.snap)):Eh(e,n)&&(t=bh(e,n),s=Ll(s,ph(),o.snap.getChild(t)));else{if(!o.children)throw i("WriteRecord should have .snap or .children");if(Eh(n,e))t=bh(n,e),s=xl(s,t,o.children);else if(Eh(e,n))if(t=bh(e,n),Ih(t))s=xl(s,ph(),o.children);else{const e=P(o.children,fh(t));if(e){const n=e.getChild(mh(t));s=Ll(s,ph(),n)}}}}}return s}function Gl(e,t,n,i,s){if(i||s){const r=ql(e.visibleWrites,t);if(!s&&Hl(r))return n;if(s||null!=n||Fl(r,ph())){const r=function(e){return(e.visible||s)&&(!i||!~i.indexOf(e.writeId))&&(Eh(e.path,t)||Eh(t,e.path))};return Bl(Kl(e.allWrites,r,t),n||nl.EMPTY_NODE)}return null}{const i=Ul(e.visibleWrites,t);if(null!=i)return i;{const i=ql(e.visibleWrites,t);return Hl(i)?n:null!=n||Fl(i,ph())?Bl(i,n||nl.EMPTY_NODE):null}}}function Yl(e,t,n,i){return Gl(e.writeTree,e.treePath,t,n,i)}function Xl(e,t){return function(e,t,n){let i=nl.EMPTY_NODE;const s=Ul(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(Gh,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const s=ql(e.visibleWrites,t);return n.forEachChild(Gh,((e,t)=>{const n=Bl(ql(s,new dh(e)),t);i=i.updateImmediateChild(e,n)})),jl(s).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return jl(ql(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function Jl(e,t,i,s){return function(e,t,i,s,r){n(s||r,"Either existingEventSnap or existingServerSnap must exist");const o=wh(t,i);if(Fl(e.visibleWrites,o))return null;{const t=ql(e.visibleWrites,o);return Hl(t)?r.getChild(i):Bl(t,r.getChild(i))}}(e.writeTree,e.treePath,t,i,s)}function Ql(e,t){return function(e,t){return Ul(e.visibleWrites,t)}(e.writeTree,wh(e.treePath,t))}function Zl(e,t,n){return function(e,t,n,i){const s=wh(t,n),r=Ul(e.visibleWrites,s);return null!=r?r:i.isCompleteForChild(n)?Bl(ql(e.visibleWrites,s),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function ec(e,t){return tc(wh(e.treePath,t),e.writeTree)}function tc(e,t){return{treePath:e,writeTree:t}}class nc{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;n("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),n(".priority"!==s,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const n=r.type;if("child_added"===t&&"child_removed"===n)this.changeMap.set(s,hl(s,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===n)this.changeMap.delete(s);else if("child_removed"===t&&"child_changed"===n)this.changeMap.set(s,(o=s,{type:"child_removed",snapshotNode:r.oldSnap,childName:o}));else if("child_changed"===t&&"child_added"===n)this.changeMap.set(s,function(e,t){return{type:"child_added",snapshotNode:t,childName:e}}(s,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==n)throw i("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(s,hl(s,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(s,e);var o}getChanges(){return Array.from(this.changeMap.values())}}const ic=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class sc{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new El(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Zl(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Al(this.viewCache_),s=function(e,t,n,i,s,r){return function(e,t,n,i,s,r,o){let a;const h=ql(e.visibleWrites,t),l=Ul(h,ph());if(null!=l)a=l;else{if(null==n)return[];a=Bl(h,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let h=n.getNext();for(;h&&e.length<s;)0!==t(h,i)&&e.push(h),h=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,s,r)}(this.writes_,i,t,1,n,e);return 0===s.length?null:s[0]}}function rc(e,t,i,s,r,o){const a=t.eventCache;if(null!=Ql(s,i))return t;{let h,l;if(Ih(i))if(n(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Al(t),i=Xl(s,n instanceof nl?n:nl.EMPTY_NODE);h=e.filter.updateFullNode(t.eventCache.getNode(),i,o)}else{const n=Yl(s,Al(t));h=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const c=fh(i);if(".priority"===c){n(1===gh(i),"Can't have a priority with additional path components");const r=a.getNode();l=t.serverCache.getNode();const o=Jl(s,i,r,l);h=null!=o?e.filter.updatePriority(r,o):a.getNode()}else{const n=mh(i);let u;if(a.isCompleteForChild(c)){l=t.serverCache.getNode();const e=Jl(s,i,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(c).updateChild(n,e):a.getNode().getImmediateChild(c)}else u=Zl(s,c,t.serverCache);h=null!=u?e.filter.updateChild(a.getNode(),c,u,n,r,o):a.getNode()}}return Sl(t,h,a.isFullyInitialized()||Ih(i),e.filter.filtersNodes())}}function oc(e,t,n,i,s,r,o,a){const h=t.serverCache;let l;const c=o?e.filter:e.filter.getIndexedFilter();if(Ih(n))l=c.updateFullNode(h.getNode(),i,null);else if(c.filtersNodes()&&!h.isFiltered()){const e=h.getNode().updateChild(n,i);l=c.updateFullNode(h.getNode(),e,null)}else{const e=fh(n);if(!h.isCompleteForPath(n)&&gh(n)>1)return t;const s=mh(n),r=h.getNode().getImmediateChild(e).updateChild(s,i);l=".priority"===e?c.updatePriority(h.getNode(),r):c.updateChild(h.getNode(),e,r,s,ic,null)}const u=Rl(t,l,h.isFullyInitialized()||Ih(n),c.filtersNodes());return rc(e,u,n,s,new sc(s,u,r),a)}function ac(e,t,n,i,s,r,o){const a=t.eventCache;let h,l;const c=new sc(s,t,r);if(Ih(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),h=Sl(t,l,!0,e.filter.filtersNodes());else{const s=fh(n);if(".priority"===s)l=e.filter.updatePriority(t.eventCache.getNode(),i),h=Sl(t,l,a.isFullyInitialized(),a.isFiltered());else{const r=mh(n),l=a.getNode().getImmediateChild(s);let u;if(Ih(r))u=i;else{const e=c.getCompleteChild(s);u=null!=e?".priority"===_h(r)&&e.getChild(vh(r)).isEmpty()?e:e.updateChild(r,i):nl.EMPTY_NODE}h=l.equals(u)?t:Sl(t,e.filter.updateChild(a.getNode(),s,u,r,c,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return h}function hc(e,t){return e.eventCache.isCompleteForChild(t)}function lc(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function cc(e,t,n,i,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h,l=t;h=Ih(n)?i:new Ol(null).setTree(n,i);const c=t.serverCache.getNode();return h.children.inorderTraversal(((n,i)=>{if(c.hasChild(n)){const h=lc(0,t.serverCache.getNode().getImmediateChild(n),i);l=oc(e,l,new dh(n),h,s,r,o,a)}})),h.children.inorderTraversal(((n,i)=>{const h=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!c.hasChild(n)&&!h){const h=lc(0,t.serverCache.getNode().getImmediateChild(n),i);l=oc(e,l,new dh(n),h,s,r,o,a)}})),l}function uc(e,t){const n=Al(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Ih(t)&&!n.getImmediateChild(fh(t)).isEmpty())?n.getChild(t):null}function dc(e,t,s,r){t.type===vl.MERGE&&null!==t.source.queryId&&(n(Al(e.viewCache_),"We should always have a full cache before handling merges"),n(Nl(e.viewCache_),"Missing event cache, even though we have a server cache"));const o=e.viewCache_,a=function(e,t,s,r,o){const a=new nc;let h,l;if(s.type===vl.OVERWRITE){const i=s;i.source.fromUser?h=ac(e,t,i.path,i.snap,r,o,a):(n(i.source.fromServer,"Unknown source."),l=i.source.tagged||t.serverCache.isFiltered()&&!Ih(i.path),h=oc(e,t,i.path,i.snap,r,o,l,a))}else if(s.type===vl.MERGE){const i=s;i.source.fromUser?h=function(e,t,n,i,s,r,o){let a=t;return i.foreach(((i,h)=>{const l=wh(n,i);hc(t,fh(l))&&(a=ac(e,a,l,h,s,r,o))})),i.foreach(((i,h)=>{const l=wh(n,i);hc(t,fh(l))||(a=ac(e,a,l,h,s,r,o))})),a}(e,t,i.path,i.children,r,o,a):(n(i.source.fromServer,"Unknown source."),l=i.source.tagged||t.serverCache.isFiltered(),h=cc(e,t,i.path,i.children,r,o,l,a))}else if(s.type===vl.ACK_USER_WRITE){const i=s;h=i.revert?function(e,t,i,s,r,o){let a;if(null!=Ql(s,i))return t;{const h=new sc(s,t,r),l=t.eventCache.getNode();let c;if(Ih(i)||".priority"===fh(i)){let i;if(t.serverCache.isFullyInitialized())i=Yl(s,Al(t));else{const e=t.serverCache.getNode();n(e instanceof nl,"serverChildren would be complete if leaf node"),i=Xl(s,e)}c=e.filter.updateFullNode(l,i,o)}else{const n=fh(i);let r=Zl(s,n,t.serverCache);null==r&&t.serverCache.isCompleteForChild(n)&&(r=l.getImmediateChild(n)),c=null!=r?e.filter.updateChild(l,n,r,mh(i),h,o):t.eventCache.getNode().hasChild(n)?e.filter.updateChild(l,n,nl.EMPTY_NODE,mh(i),h,o):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=Yl(s,Al(t)),a.isLeafNode()&&(c=e.filter.updateFullNode(c,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=Ql(s,ph()),Sl(t,c,a,e.filter.filtersNodes())}}(e,t,i.path,r,o,a):function(e,t,n,i,s,r,o){if(null!=Ql(s,n))return t;const a=t.serverCache.isFiltered(),h=t.serverCache;if(null!=i.value){if(Ih(n)&&h.isFullyInitialized()||h.isCompleteForPath(n))return oc(e,t,n,h.getNode().getChild(n),s,r,a,o);if(Ih(n)){let i=new Ol(null);return h.getNode().forEachChild(xh,((e,t)=>{i=i.set(new dh(e),t)})),cc(e,t,n,i,s,r,a,o)}return t}{let l=new Ol(null);return i.foreach(((e,t)=>{const i=wh(n,e);h.isCompleteForPath(i)&&(l=l.set(e,h.getNode().getChild(i)))})),cc(e,t,n,l,s,r,a,o)}}(e,t,i.path,i.affectedTree,r,o,a)}else{if(s.type!==vl.LISTEN_COMPLETE)throw i("Unknown operation type: "+s.type);h=function(e,t,n,i,s){const r=t.serverCache;return rc(e,Rl(t,r.getNode(),r.isFullyInitialized()||Ih(n),r.isFiltered()),n,i,ic,s)}(e,t,s.path,r,a)}const c=a.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Nl(e);(n.length>0||!e.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push({type:"value",snapshotNode:Nl(t)})}}(t,h,c),{viewCache:h,changes:c}}(e.processor_,o,t,s,r);var h,l;return h=e.processor_,l=a.viewCache,n(l.eventCache.getNode().isIndexed(h.filter.getIndex()),"Event snap not indexed"),n(l.serverCache.getNode().isIndexed(h.filter.getIndex()),"Server snap not indexed"),n(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,function(e,t,n,i){const s=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const s=[],r=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&r.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Cl(e,s,"child_removed",t,i,n),Cl(e,s,"child_added",t,i,n),Cl(e,s,"child_moved",r,i,n),Cl(e,s,"child_changed",t,i,n),Cl(e,s,"value",t,i,n),s}(e.eventGenerator_,t,n,s)}(e,a.changes,a.viewCache.eventCache.getNode(),null)}let pc,fc;function gc(e,t,i,s){const r=t.source.queryId;if(null!==r){const o=e.views.get(r);return n(null!=o,"SyncTree gave us an op for an invalid query."),dc(o,t,i,s)}{let n=[];for(const r of e.views.values())n=n.concat(dc(r,t,i,s));return n}}function mc(e,t){let n=null;for(const i of e.views.values())n=n||uc(i,t);return n}class _c{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ol(null),this.pendingWriteTree_={visibleWrites:Dl.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function yc(e,t,i,s,r){return function(e,t,i,s,r){n(s>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:t,snap:i,writeId:s,visible:r}),r&&(e.visibleWrites=Ll(e.visibleWrites,t,i)),e.lastWriteId=s}(e.pendingWriteTree_,t,i,s,r),r?bc(e,new bl({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,i)):[]}function vc(e,t,i=!1){const s=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(function(e,t){const i=e.allWrites.findIndex((e=>e.writeId===t));n(i>=0,"removeWrite called with nonexistent writeId.");const s=e.allWrites[i];e.allWrites.splice(i,1);let r=s.visible,o=!1,a=e.allWrites.length-1;for(;r&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=i&&zl(t,s.path)?r=!1:Eh(s.path,t.path)&&(o=!0)),a--}return!!r&&(o?(function(e){e.visibleWrites=Kl(e.allWrites,$l,ph()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(s.snap?e.visibleWrites=Ml(e.visibleWrites,s.path):Oa(s.children,(t=>{e.visibleWrites=Ml(e.visibleWrites,wh(s.path,t))})),!0))}(e.pendingWriteTree_,t)){let t=new Ol(null);return null!=s.snap?t=t.set(ph(),!0):Oa(s.children,(e=>{t=t.set(new dh(e),!0)})),bc(e,new Il(s.path,t,i))}return[]}function wc(e,t,n){return bc(e,new bl({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Ic(e,t,n){const i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=mc(n,bh(e,t));if(i)return i}));return Gl(i,t,s,n,!0)}function bc(e,t){return Tc(t,e.syncPointTree_,null,Wl(e.pendingWriteTree_,ph()))}function Tc(e,t,n,i){if(Ih(e.path))return Ec(e,t,n,i);{const s=t.get(ph());null==n&&null!=s&&(n=mc(s,ph()));let r=[];const o=fh(e.path),a=e.operationForChild(o),h=t.children.get(o);if(h&&a){const e=n?n.getImmediateChild(o):null,t=ec(i,o);r=r.concat(Tc(a,h,e,t))}return s&&(r=r.concat(gc(s,e,i,n))),r}}function Ec(e,t,n,i){const s=t.get(ph());null==n&&null!=s&&(n=mc(s,ph()));let r=[];return t.children.inorderTraversal(((t,s)=>{const o=n?n.getImmediateChild(t):null,a=ec(i,t),h=e.operationForChild(t);h&&(r=r.concat(Ec(h,s,o,a)))})),s&&(r=r.concat(gc(s,e,i,n))),r}function Cc(e,t){return e.tagToQueryMap.get(t)}function kc(e){const t=e.indexOf("$");return n(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new dh(e.substr(0,t))}}function Sc(e,t,i){const s=e.syncPointTree_.get(t);return n(s,"Missing sync point for query tag that we're tracking"),gc(s,i,Wl(e.pendingWriteTree_,t),null)}class Rc{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Rc(t)}node(){return this.node_}}class Nc{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=wh(this.path_,e);return new Nc(this.syncTree_,t)}node(){return Ic(this.syncTree_,this.path_)}}const Ac=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},Pc=function(e,t,i){return e&&"object"==typeof e?(n(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Oc(e[".sv"],t,i):"object"==typeof e[".sv"]?Dc(e[".sv"],t):void n(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Oc=function(e,t,i){if("timestamp"===e)return i.timestamp;n(!1,"Unexpected server value: "+e)},Dc=function(e,t,i){e.hasOwnProperty("increment")||n(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const s=e.increment;"number"!=typeof s&&n(!1,"Unexpected increment value: "+s);const r=t.node();if(n(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return"number"!=typeof o?s:o+s},Lc=function(e,t,n,i){return Mc(t,new Nc(n,e),i)},xc=function(e,t,n){return Mc(e,new Rc(t),n)};function Mc(e,t,n){const i=e.getPriority().val(),s=Pc(i,t.getImmediateChild(".priority"),n);let r;if(e.isLeafNode()){const i=e,r=Pc(i.getValue(),t,n);return r!==i.getValue()||s!==i.getPriority().val()?new Kh(r,rl(s)):e}{const i=e;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new Kh(s))),i.forEachChild(Gh,((e,i)=>{const s=Mc(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))})),r}}class Fc{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Uc(e,t){let n=t instanceof dh?t:new dh(t),i=e,s=fh(n);for(;null!==s;){const e=P(i.node.children,s)||{children:{},childCount:0};i=new Fc(s,i,e),n=mh(n),s=fh(n)}return i}function jc(e){return e.node.value}function qc(e,t){e.node.value=t,zc(e)}function Hc(e){return e.node.childCount>0}function Bc(e,t){Oa(e.node.children,((n,i)=>{t(new Fc(n,e,i))}))}function Vc(e,t,n,i){n&&!i&&t(e),Bc(e,(e=>{Vc(e,t,!0,i)})),n&&i&&t(e)}function Wc(e){return new dh(null===e.parent?e.name:Wc(e.parent)+"/"+e.name)}function zc(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===jc(e)&&!Hc(e)}(n),s=A(e.node.children,t);i&&s?(delete e.node.children[t],e.node.childCount--,zc(e)):i||s||(e.node.children[t]=n.node,e.node.childCount++,zc(e))}(e.parent,e.name,e)}const $c=/[\[\].#$\/\u0000-\u001F\u007F]/,Kc=/[\[\].#$\u0000-\u001F\u007F]/,Gc=10485760,Yc=function(e){return"string"==typeof e&&0!==e.length&&!$c.test(e)},Xc=function(e,t,n){const i=n instanceof dh?new Ch(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Sh(i));if("function"==typeof t)throw new Error(e+"contains a function "+Sh(i)+" with contents = "+t.toString());if(Ea(t))throw new Error(e+"contains "+t.toString()+" "+Sh(i));if("string"==typeof t&&t.length>Gc/3&&B(t)>Gc)throw new Error(e+"contains a string greater than "+Gc+" utf8 bytes "+Sh(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,s=!1;if(Oa(t,((t,r)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!Yc(t)))throw new Error(e+" contains an invalid key ("+t+") "+Sh(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var o,a;a=t,(o=i).parts_.length>0&&(o.byteLength_+=1),o.parts_.push(a),o.byteLength_+=B(a),kh(o),Xc(e,r,i),function(e){const t=e.parts_.pop();e.byteLength_-=B(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&s)throw new Error(e+' contains ".value" child '+Sh(i)+" in addition to actual children.")}},Jc=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Yc(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),function(e){return"string"==typeof e&&0!==e.length&&!Kc.test(e)}(e)}(n))throw new Error(function(e,t){return`${e} failed: ${t} argument `}(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Qc{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Zc(e,t,n){(function(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i],r=s.getPath();null===n||Th(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)})(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const s=e.eventLists_[i];s&&(t(s.path)?(eu(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,(e=>Eh(e,t)||Eh(t,e)))}function eu(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();_a&&va("event: "+n.toString()),Ma(i)}}}const tu="repo_interrupt",nu=25;class iu{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Qc,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=fl(),this.transactionQueueTree_=new Fc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function su(e,t,n){if(e.stats_=Qa(e.repoInfo_),e.forceRestClient_||Fa())e.server_=new dl(e.repoInfo_,((t,n,i,s)=>{au(e,t,n,i,s)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>hu(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{R(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Ah(e.repoInfo_,t,((t,n,i,s)=>{au(e,t,n,i,s)}),(t=>{hu(e,t)}),(t=>{!function(e,t){Oa(t,((t,n)=>{lu(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(t,n){const i=t.toString();return Ja[i]||(Ja[i]=new yl(e.stats_,e.server_)),Ja[i]}(e.repoInfo_),e.infoData_=new pl,e.infoSyncTree_=new _c({startListening:(t,n,i,s)=>{let r=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(r=wc(e.infoSyncTree_,t._path,o),setTimeout((()=>{s("ok")}),0)),r},stopListening:()=>{}}),lu(e,"connected",!1),e.serverSyncTree_=new _c({startListening:(t,n,i,s)=>(e.server_.listen(t,i,n,((n,i)=>{const r=s(n,i);Zc(e.eventQueue_,t._path,r)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function ru(e){const t=e.infoData_.getNode(new dh(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ou(e){return Ac({timestamp:ru(e)})}function au(e,t,n,i,s){e.dataUpdateCount++;const r=new dh(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(s)if(i){const t=D(n,(e=>rl(e)));o=function(e,t,n,i){const s=Cc(e,i);if(s){const i=kc(s),r=i.path,o=i.queryId,a=bh(r,t),h=Ol.fromObject(n);return Sc(e,r,new Tl(wl(o),a,h))}return[]}(e.serverSyncTree_,r,t,s)}else{const t=rl(n);o=function(e,t,n,i){const s=Cc(e,i);if(null!=s){const i=kc(s),r=i.path,o=i.queryId,a=bh(r,t);return Sc(e,r,new bl(wl(o),a,n))}return[]}(e.serverSyncTree_,r,t,s)}else if(i){const t=D(n,(e=>rl(e)));o=function(e,t,n){const i=Ol.fromObject(n);return bc(e,new Tl({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,r,t)}else{const t=rl(n);o=wc(e.serverSyncTree_,r,t)}let a=r;o.length>0&&(a=fu(e,r)),Zc(e.eventQueue_,a,o)}function hu(e,t){lu(e,"connected",t),!1===t&&function(e){uu(e,"onDisconnectEvents");const t=ou(e),n=fl();ml(e.onDisconnect_,ph(),((i,s)=>{const r=Lc(i,s,e.serverSyncTree_,t);gl(n,i,r)}));let i=[];ml(n,ph(),((t,n)=>{i=i.concat(wc(e.serverSyncTree_,t,n));const s=function(e,t){const n=Wc(gu(e,t)),i=Uc(e.transactionQueueTree_,t);return function(e,t,n){let i=void 0?e:e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,(t=>{vu(e,t)})),vu(e,i),Vc(i,(t=>{vu(e,t)})),n}(e,t);fu(e,s)})),e.onDisconnect_=fl(),Zc(e.eventQueue_,ph(),i)}(e)}function lu(e,t,n){const i=new dh("/.info/"+t),s=rl(n);e.infoData_.updateSnapshot(i,s);const r=wc(e.infoSyncTree_,i,s);Zc(e.eventQueue_,i,r)}function cu(e){return e.nextWriteId_++}function uu(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),va(n,...t)}function du(e,t,n){return Ic(e.serverSyncTree_,t,n)||nl.EMPTY_NODE}function pu(e,t=e.transactionQueueTree_){if(t||yu(e,t),jc(t)){const i=mu(e,t);n(i.length>0,"Sending zero length transaction queue"),i.every((e=>0===e.status))&&function(e,t,i){const s=i.map((e=>e.currentWriteId)),r=du(e,t,s);let o=r;const a=r.hash();for(let e=0;e<i.length;e++){const s=i[e];n(0===s.status,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=1,s.retryCount++;const r=bh(t,s.path);o=o.updateChild(r,s.currentOutputSnapshotRaw)}const h=o.val(!0),l=t;e.server_.put(l.toString(),h,(n=>{uu(e,"transaction put response",{path:l.toString(),status:n});let s=[];if("ok"===n){const n=[];for(let t=0;t<i.length;t++)i[t].status=2,s=s.concat(vc(e.serverSyncTree_,i[t].currentWriteId)),i[t].onComplete&&n.push((()=>i[t].onComplete(null,!0,i[t].currentOutputSnapshotResolved))),i[t].unwatcher();yu(e,Uc(e.transactionQueueTree_,t)),pu(e,e.transactionQueueTree_),Zc(e.eventQueue_,t,s);for(let e=0;e<n.length;e++)Ma(n[e])}else{if("datastale"===n)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{Ta("transaction at "+l.toString()+" failed: "+n);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=n}fu(e,t)}}),a)}(e,Wc(t),i)}else Hc(t)&&Bc(t,(t=>{pu(e,t)}))}function fu(e,t){const i=gu(e,t),s=Wc(i);return function(e,t,i){if(0===t.length)return;const s=[];let r=[];const o=t.filter((e=>0===e.status)),a=o.map((e=>e.currentWriteId));for(let o=0;o<t.length;o++){const l=t[o],c=bh(i,l.path);let u,d=!1;if(n(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,r=r.concat(vc(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=nu)d=!0,u="maxretry",r=r.concat(vc(e.serverSyncTree_,l.currentWriteId,!0));else{const n=du(e,l.path,a);l.currentInputSnapshot=n;const i=t[o].update(n.val());if(void 0!==i){Xc("transaction failed: Data returned ",i,l.path);let t=rl(i);"object"==typeof i&&null!=i&&A(i,".priority")||(t=t.updatePriority(n.getPriority()));const s=l.currentWriteId,o=ou(e),h=xc(t,n,o);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=h,l.currentWriteId=cu(e),a.splice(a.indexOf(s),1),r=r.concat(yc(e.serverSyncTree_,l.path,h,l.currentWriteId,l.applyLocally)),r=r.concat(vc(e.serverSyncTree_,s,!0))}else d=!0,u="nodata",r=r.concat(vc(e.serverSyncTree_,l.currentWriteId,!0))}Zc(e.eventQueue_,i,r),r=[],d&&(t[o].status=2,h=t[o].unwatcher,setTimeout(h,Math.floor(0)),t[o].onComplete&&("nodata"===u?s.push((()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot))):s.push((()=>t[o].onComplete(new Error(u),!1,null)))))}var h;yu(e,e.transactionQueueTree_);for(let e=0;e<s.length;e++)Ma(s[e]);pu(e,e.transactionQueueTree_)}(e,mu(e,i),s),s}function gu(e,t){let n,i=e.transactionQueueTree_;for(n=fh(t);null!==n&&void 0===jc(i);)i=Uc(i,n),n=fh(t=mh(t));return i}function mu(e,t){const n=[];return _u(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function _u(e,t,n){const i=jc(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);Bc(t,(t=>{_u(e,t,n)}))}function yu(e,t){const n=jc(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,qc(t,n.length>0?n:void 0)}Bc(t,(t=>{yu(e,t)}))}function vu(e,t){const i=jc(t);if(i){const s=[];let r=[],o=-1;for(let t=0;t<i.length;t++)3===i[t].status||(1===i[t].status?(n(o===t-1,"All SENT items should be at beginning of queue."),o=t,i[t].status=3,i[t].abortReason="set"):(n(0===i[t].status,"Unexpected transaction status in abort"),i[t].unwatcher(),r=r.concat(vc(e.serverSyncTree_,i[t].currentWriteId,!0)),i[t].onComplete&&s.push(i[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?qc(t,void 0):i.length=o+1,Zc(e.eventQueue_,Wc(t),r);for(let e=0;e<s.length;e++)Ma(s[e])}}const wu=function(e,t){const n=Iu(e),i=n.namespace;"firebase.com"===n.domain&&ba(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||ba("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ta("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Ka(n.host,n.secure,i,s,t,"",i!==n.subdomain),path:new dh(n.pathString)}},Iu=function(e){let t="",n="",i="",s="",r="",o=!0,a="https",h=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let c=e.indexOf("/");-1===c&&(c=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(c,u)),c<u&&(s=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(c,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Ta(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,h=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),r=i}"ns"in d&&(r=d.ns)}return{host:t,port:h,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class bu{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return Ih(this._path)?null:_h(this._path)}get ref(){return new Tu(this._repo,this._path)}get _queryIdentifier(){const e=ul(this._queryParams),t=Aa(e);return"{}"===t?"default":t}get _queryObject(){return ul(this._queryParams)}isEqual(e){if(!((e=G(e))instanceof bu))return!1;const t=this._repo===e._repo,n=Th(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Tu extends bu{constructor(e,t){super(e,t,new ll,!1)}get parent(){const e=vh(this._path);return null===e?null:new Tu(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}!function(e){n(!pc,"__referenceConstructor has already been defined"),pc=e}(Tu),function(e){n(!fc,"__referenceConstructor has already been defined"),fc=e}(Tu);const Eu="FIREBASE_DATABASE_EMULATOR_HOST",Cu={};let ku=!1;class Su{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(su(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Tu(this._repo,ph())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=Cu[t];n&&n[e.key]===e||ba(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt(tu)}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&ba("Cannot call "+e+" on a deleted database.")}}function Ru(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}Ah.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Ah.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},aa=Ue,Le(new Y("database",((e,{instanceIdentifier:t})=>function(e,t,n,i,s){let r=i||e.options.databaseURL;void 0===r&&(e.options.projectId||ba("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),va("Using default host for project ",e.options.projectId),r=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,h=wu(r,s),l=h.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env[Eu]),a?(o=!0,r=`http://${a}?ns=${l.namespace}`,h=wu(r,s),l=h.repoInfo):o=!h.repoInfo.secure;const c=s&&o?new Ha(Ha.OWNER):new qa(e.name,e.options,t);Jc("Invalid Firebase Database URL",h),Ih(h.path)||ba("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,i){let s=Cu[t.name];s||(s={},Cu[t.name]=s);let r=s[e.toURLString()];return r&&ba("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new iu(e,ku,n,i),s[e.toURLString()]=r,r}(l,e,c,new ja(e.name,n));return new Su(u,e)}(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),He(ra,oa,void 0),He(ra,oa,"esm2017"),Object.create,Object.create;const Nu=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Au=new C("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Pu=new oe("@firebase/auth");function Ou(e,...t){Pu.logLevel<=ee.ERROR&&Pu.error(`Auth (${Ue}): ${e}`,...t)}function Du(e,...t){throw xu(e,...t)}function Lu(e,...t){return xu(e,...t)}function xu(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return Au.create(e,...t)}function Mu(e,t,...n){if(!e)throw xu(t,...n)}function Fu(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Ou(t),new Error(t)}function Uu(e,t){e||Fu(t)}const ju=new Map;function qu(e){Uu(e instanceof Function,"Expected a class definition");let t=ju.get(e);return t?(Uu(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,ju.set(e,t),t)}function Hu(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Bu(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Vu{constructor(e,t){this.shortDelay=e,this.longDelay=t,Uu(t>e,"Short delay should be less than long delay!"),this.isMobile=y()||w()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Bu()||"https:"===Bu()||v()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Wu(e,t){Uu(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class zu{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Fu("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Fu("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Fu("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const $u={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Ku=new Vu(3e4,6e4);function Gu(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Yu(e,t,n,i,s={}){return Xu(e,s,(async()=>{let s={},r={};i&&("GET"===t?r=i:s={body:JSON.stringify(i)});const o=M(Object.assign({key:e.config.apiKey},r)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),zu.fetch()(Qu(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},s))}))}async function Xu(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},$u),t);try{const t=new Zu(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw ed(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ed(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw ed(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw ed(e,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const i=Object.assign(Object.assign({},Nu()),{[t]:n});return new C("auth","Firebase",i).create(t,{appName:e.name})}(e,a,o);Du(e,a)}}catch(t){if(t instanceof E)throw t;Du(e,"internal-error",{message:String(t)})}}async function Ju(e,t,n,i,s={}){const r=await Yu(e,t,n,i,s);return"mfaPendingCredential"in r&&Du(e,"multi-factor-auth-required",{_serverResponse:r}),r}function Qu(e,t,n,i){const s=`${t}${n}?${i}`;return e.config.emulator?Wu(e.config,s):`${e.config.apiScheme}://${s}`}class Zu{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Lu(this.auth,"network-request-failed"))),Ku.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ed(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=Lu(e,t,i);return s.customData._tokenResponse=n,s}function td(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function nd(e){return 1e3*Number(e)}function id(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return Ou("JWT malformed, contained fewer than 3 sections"),null;try{const e=l(n);return e?JSON.parse(e):(Ou("Failed to decode base64 JWT payload"),null)}catch(e){return Ou("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function sd(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof E&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class rd{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class od{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=td(this.lastLoginAt),this.creationTime=td(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ad(e){var t;const n=e.auth,i=await e.getIdToken(),s=await sd(e,async function(e,t){return Yu(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));Mu(null==s?void 0:s.users.length,n,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const o=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?r.providerUserInfo.map((e=>{var{providerId:t}=e,n=Ru(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(h=e.providerData,l=o,[...h.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var h,l;const c=e.isAnonymous,u=!(e.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!c&&u,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new od(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(e,p)}class hd{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Mu(e.idToken,"internal-error"),Mu(void 0!==e.idToken,"internal-error"),Mu(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=id(e);return Mu(t,"internal-error"),Mu(void 0!==t.exp,"internal-error"),Mu(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Mu(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await Xu(e,{},(async()=>{const n=M({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,r=Qu(e,i,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",zu.fetch()(r,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new hd;return n&&(Mu("string"==typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(Mu("string"==typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(Mu("number"==typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new hd,this.toJSON())}_performRefresh(){return Fu("not implemented")}}function ld(e,t){Mu("string"==typeof e||void 0===e,"internal-error",{appName:t})}class cd{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=Ru(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new rd(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new od(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await sd(this,this.stsTokenManager.getToken(this.auth,e));return Mu(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=G(e),i=await n.getIdToken(t),s=id(i);Mu(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"==typeof s.firebase?s.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:td(nd(s.auth_time)),issuedAtTime:td(nd(s.iat)),expirationTime:td(nd(s.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=G(e);await ad(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Mu(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new cd(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Mu(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ad(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await sd(this,async function(e,t){return Yu(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,r,o,a,h,l;const c=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,p=null!==(r=t.photoURL)&&void 0!==r?r:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(h=t.createdAt)&&void 0!==h?h:void 0,_=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:y,emailVerified:v,isAnonymous:w,providerData:I,stsTokenManager:b}=t;Mu(y&&b,e,"internal-error");const T=hd.fromJSON(this.name,b);Mu("string"==typeof y,e,"internal-error"),ld(c,e.name),ld(u,e.name),Mu("boolean"==typeof v,e,"internal-error"),Mu("boolean"==typeof w,e,"internal-error"),ld(d,e.name),ld(p,e.name),ld(f,e.name),ld(g,e.name),ld(m,e.name),ld(_,e.name);const E=new cd({uid:y,auth:e,email:u,emailVerified:v,displayName:c,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:T,createdAt:m,lastLoginAt:_});return I&&Array.isArray(I)&&(E.providerData=I.map((e=>Object.assign({},e)))),g&&(E._redirectEventId=g),E}static async _fromIdTokenResponse(e,t,n=!1){const i=new hd;i.updateFromServerResponse(t);const s=new cd({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await ad(s),s}}class ud{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ud.type="NONE";const dd=ud;function pd(e,t,n){return`firebase:${e}:${t}:${n}`}class fd{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=pd(this.userKey,i.apiKey,s),this.fullPersistenceKey=pd("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?cd._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new fd(qu(dd),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=i[0]||qu(dd);const r=pd(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(r);if(t){const i=cd._fromJSON(e,t);n!==s&&(o=i),s=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(r)}catch(e){}}))),new fd(s,e,n)):new fd(s,e,n)}}function gd(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(vd(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(md(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Id(t))return"Blackberry";if(bd(t))return"Webos";if(_d(t))return"Safari";if((t.includes("chrome/")||yd(t))&&!t.includes("edge/"))return"Chrome";if(wd(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function md(e=_()){return/firefox\//i.test(e)}function _d(e=_()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function yd(e=_()){return/crios\//i.test(e)}function vd(e=_()){return/iemobile/i.test(e)}function wd(e=_()){return/android/i.test(e)}function Id(e=_()){return/blackberry/i.test(e)}function bd(e=_()){return/webos/i.test(e)}function Td(e=_()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ed(e=_()){return Td(e)||wd(e)||bd(e)||Id(e)||/windows phone/i.test(e)||vd(e)}function Cd(e,t=[]){let n;switch(e){case"Browser":n=gd(_());break;case"Worker":n=`${gd(_())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ue}/${i}`}class kd{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Sd{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Nd(this),this.idTokenSubscription=new Nd(this),this.beforeStateQueue=new kd(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Au,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=qu(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await fd.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Mu(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ad(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?G(e):null;return t&&Mu(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Mu(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(qu(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new C("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&qu(e)||this._popupRedirectResolver;Mu(t,this,"argument-error"),this.redirectPersistenceManager=await fd.create(this,[qu(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),r=this._isInitialized?Promise.resolve():this._initializationPromise;return Mu(r,this,"internal-error"),r.then((()=>s(this.currentUser))),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Mu(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Cd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function Rd(e){return G(e)}class Nd{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new q(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Mu(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ad(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Pd(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Od{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Fu("not implemented")}_getIdTokenResponse(e){return Fu("not implemented")}_linkToIdToken(e,t){return Fu("not implemented")}_getReauthenticationResolver(e){return Fu("not implemented")}}class Dd extends Od{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Dd(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Dd(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Ju(e,"POST","/v1/accounts:signInWithPassword",Gu(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Ju(e,"POST","/v1/accounts:signInWithEmailLink",Gu(e,t))}(e,{email:this._email,oobCode:this._password});default:Du(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return Yu(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Ju(e,"POST","/v1/accounts:signInWithEmailLink",Gu(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Du(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ld(e,t){return Ju(e,"POST","/v1/accounts:signInWithIdp",Gu(e,t))}class xd extends Od{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new xd(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Du("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=Ru(t,["providerId","signInMethod"]);if(!n||!i)return null;const r=new xd(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return Ld(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ld(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ld(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=M(t)}return e}}const Md={USER_NOT_FOUND:"user-not-found"};class Fd extends Od{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Fd({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Fd({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Ju(e,"POST","/v1/accounts:signInWithPhoneNumber",Gu(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Ju(e,"POST","/v1/accounts:signInWithPhoneNumber",Gu(e,t));if(n.temporaryProof)throw ed(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Ju(e,"POST","/v1/accounts:signInWithPhoneNumber",Gu(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Md)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new Fd({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class Ud{constructor(e){var t,n,i,s,r,o;const a=F(U(e)),h=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,c=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);Mu(h&&l&&c,"argument-error"),this.apiKey=h,this.operation=c,this.code=l,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=a.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=F(U(e)).link,n=t?F(U(t)).deep_link_id:null,i=F(U(e)).deep_link_id;return(i?F(U(i)).link:null)||i||n||t||e}(e);try{return new Ud(t)}catch(e){return null}}}class jd{constructor(){this.providerId=jd.PROVIDER_ID}static credential(e,t){return Dd._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ud.parseLink(t);return Mu(n,"argument-error"),Dd._fromEmailAndCode(e,n.code,n.tenantId)}}jd.PROVIDER_ID="password",jd.EMAIL_PASSWORD_SIGN_IN_METHOD="password",jd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class qd{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Hd extends qd{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Bd extends Hd{constructor(){super("facebook.com")}static credential(e){return xd._fromParams({providerId:Bd.PROVIDER_ID,signInMethod:Bd.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Bd.credentialFromTaggedObject(e)}static credentialFromError(e){return Bd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Bd.credential(e.oauthAccessToken)}catch(e){return null}}}Bd.FACEBOOK_SIGN_IN_METHOD="facebook.com",Bd.PROVIDER_ID="facebook.com";class Vd extends Hd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return xd._fromParams({providerId:Vd.PROVIDER_ID,signInMethod:Vd.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Vd.credentialFromTaggedObject(e)}static credentialFromError(e){return Vd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Vd.credential(t,n)}catch(e){return null}}}Vd.GOOGLE_SIGN_IN_METHOD="google.com",Vd.PROVIDER_ID="google.com";class Wd extends Hd{constructor(){super("github.com")}static credential(e){return xd._fromParams({providerId:Wd.PROVIDER_ID,signInMethod:Wd.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Wd.credentialFromTaggedObject(e)}static credentialFromError(e){return Wd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Wd.credential(e.oauthAccessToken)}catch(e){return null}}}Wd.GITHUB_SIGN_IN_METHOD="github.com",Wd.PROVIDER_ID="github.com";class zd extends Hd{constructor(){super("twitter.com")}static credential(e,t){return xd._fromParams({providerId:zd.PROVIDER_ID,signInMethod:zd.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return zd.credentialFromTaggedObject(e)}static credentialFromError(e){return zd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return zd.credential(t,n)}catch(e){return null}}}zd.TWITTER_SIGN_IN_METHOD="twitter.com",zd.PROVIDER_ID="twitter.com";class $d{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await cd._fromIdTokenResponse(e,n,i),r=Kd(n);return new $d({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=Kd(n);return new $d({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function Kd(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Gd extends E{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Gd.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Gd(e,t,n,i)}}function Yd(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Gd._fromErrorAndOperation(e,n,t,i);throw n}))}async function Xd(e,t,n=!1){const i="signIn",s=await Yd(e,i,t),r=await $d._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(r.user),r}new WeakMap;const Jd="__sak";class Qd{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Jd,"1"),this.storage.removeItem(Jd),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Zd extends Qd{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=_();return _d(e)||Td(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Ed(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);!function(){const e=_();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Zd.type="LOCAL";const ep=Zd;class tp extends Qd{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}tp.type="SESSION";const np=tp;class ip{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new ip(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function sp(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ip.receivers=[];class rp{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const h=sp("",20);i.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===h)switch(t.data.status){case"ack":clearTimeout(l),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(l),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:h,data:t},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function op(){return window}function ap(){return void 0!==op().WorkerGlobalScope&&"function"==typeof op().importScripts}const hp="firebaseLocalStorageDb",lp=1,cp="firebaseLocalStorage",up="fbase_key";class dp{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function pp(e,t){return e.transaction([cp],t?"readwrite":"readonly").objectStore(cp)}function fp(){const e=indexedDB.open(hp,lp);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(cp,{keyPath:up})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(cp)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(hp);return new dp(e).toPromise()}(),t(await fp()))}))}))}async function gp(e,t,n){const i=pp(e,!0).put({[up]:t,value:n});return new dp(i).toPromise()}function mp(e,t){const n=pp(e,!0).delete(t);return new dp(n).toPromise()}class _p{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await fp()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ap()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ip._getInstance(ap()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new rp(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}var t}async _isAvailable(){try{if(!indexedDB)return!1;const e=await fp();return await gp(e,Jd,"1"),await mp(e,Jd),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>gp(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=pp(e,!1).get(t),i=await new dp(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>mp(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=pp(e,!1).getAll();return new dp(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}_p.type="LOCAL";const yp=_p;function vp(e){return`__${e}${Math.floor(1e6*Math.random())}`}vp("rcb"),new Vu(3e4,6e4);const wp="recaptcha";class Ip{constructor(e){this.providerId=Ip.PROVIDER_ID,this.auth=Rd(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var i;const s=await n.verify();try{let r;if(Mu("string"==typeof s,e,"argument-error"),Mu(n.type===wp,e,"argument-error"),r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){Mu("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Yu(e,"POST","/v2/accounts/mfaEnrollment:start",Gu(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{Mu("signin"===t.type,e,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;Mu(n,e,"missing-multi-factor-info");const o=await function(e,t){return Yu(e,"POST","/v2/accounts/mfaSignIn:start",Gu(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Yu(e,"POST","/v1/accounts:sendVerificationCode",Gu(e,t))}(e,{phoneNumber:r.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}}(this.auth,e,G(t))}static credential(e,t){return Fd._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Ip.credentialFromTaggedObject(t)}static credentialFromError(e){return Ip.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Fd._fromTokenResponse(t,n):null}}Ip.PROVIDER_ID="phone",Ip.PHONE_SIGN_IN_METHOD="phone";class bp extends Od{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ld(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ld(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ld(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Tp(e){return Xd(e.auth,new bp(e),e.bypassAuthState)}function Ep(e){const{auth:t,user:n}=e;return Mu(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e,s="reauthenticate";try{const r=await sd(e,Yd(i,s,t,e),n);Mu(r.idToken,i,"internal-error");const o=id(r.idToken);Mu(o,i,"internal-error");const{sub:a}=o;return Mu(e.uid===a,i,"user-mismatch"),$d._forOperation(e,s,r)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Du(i,"user-mismatch"),e}}(n,new bp(e),e.bypassAuthState)}async function Cp(e){const{auth:t,user:n}=e;return Mu(n,t,"internal-error"),async function(e,t,n=!1){const i=await sd(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return $d._forOperation(e,"link",i)}(n,new bp(e),e.bypassAuthState)}class kp{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Tp;case"linkViaPopup":case"linkViaRedirect":return Cp;case"reauthViaPopup":case"reauthViaRedirect":return Ep;default:Du(this.auth,"internal-error")}}resolve(e){Uu(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Uu(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Sp=new Vu(2e3,1e4);class Rp extends kp{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,Rp.currentPopupAction&&Rp.currentPopupAction.cancel(),Rp.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Mu(e,this.auth,"internal-error"),e}async onExecution(){Uu(1===this.filter.length,"Popup operations only handle one event");const e=sp();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Lu(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Lu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Rp.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Lu(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,Sp.get())};e()}}Rp.currentPopupAction=null;const Np="pendingRedirect",Ap=new Map;class Pp extends kp{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Ap.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return pd(Np,e.config.apiKey,e.name)}(t),i=function(e){return qu(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Ap.set(this.auth._key(),e)}return this.bypassAuthState||Ap.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Op(e,t){Ap.set(e._key(),t)}async function Dp(e,t,n=!1){const i=Rd(e),s=function(e,t){return t?qu(t):(Mu(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(i,t),r=new Pp(i,s,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class Lp{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Mp(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Mp(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Lu(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(xp(e))}saveEventToCache(e){this.cachedEventUids.add(xp(e)),this.lastProcessedEventTime=Date.now()}}function xp(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Mp({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Fp=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Up=/^https?/;function jp(e){const t=Hu(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!Up.test(n))return!1;if(Fp.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const qp=new Vu(3e4,6e4);function Hp(){const e=op().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Bp=null;function Vp(e){return Bp=Bp||function(e){return new Promise(((t,n)=>{var i,s,r,o;function a(){Hp(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Hp(),n(Lu(e,"network-request-failed"))},timeout:qp.get()})}if(null===(s=null===(i=op().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=op().gapi)||void 0===r?void 0:r.load)){const t=vp("iframefcb");return op()[t]=()=>{gapi.load?a():n(Lu(e,"network-request-failed"))},(o=`https://apis.google.com/js/api.js?onload=${t}`,new Promise(((e,t)=>{const n=document.createElement("script");var i,s;n.setAttribute("src",o),n.onload=e,n.onerror=e=>{const n=Lu("internal-error");n.customData=e,t(n)},n.type="text/javascript",n.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(n)}))).catch((e=>n(e)))}a()}})).catch((e=>{throw Bp=null,e}))}(e),Bp}const Wp=new Vu(5e3,15e3),zp="__/auth/iframe",$p="emulator/auth/iframe",Kp={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Gp=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Yp(e){const t=e.config;Mu(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Wu(t,$p):`https://${e.config.authDomain}/${zp}`,i={apiKey:t.apiKey,appName:e.name,v:Ue},s=Gp.get(e.config.apiHost);s&&(i.eid=s);const r=e._getFrameworks();return r.length&&(i.fw=r.join(",")),`${n}?${M(i).slice(1)}`}const Xp={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Jp=500,Qp=600,Zp="_blank",ef="http://localhost";class tf{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const nf="__/auth/handler",sf="emulator/auth/handler";function rf(e,t,n,i,s,r){Mu(e.config.authDomain,e,"auth-domain-config-required"),Mu(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:Ue,eventId:s};if(t instanceof qd){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",O(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(r||{}))o[e]=t}if(t instanceof Hd){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){return e.emulator?Wu(e,sf):`https://${e.authDomain}/${nf}`}(e)}?${M(a).slice(1)}`}const of="webStorageSupport",af=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=np,this._completeRedirectFn=Dp,this._overrideRedirectResult=Op}async _openPopup(e,t,n,i){var s;return Uu(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=Jp,s=Qp){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const h=Object.assign(Object.assign({},Xp),{width:i.toString(),height:s.toString(),top:r,left:o}),l=_().toLowerCase();n&&(a=yd(l)?Zp:n),md(l)&&(t=t||ef,h.scrollbars="yes");const c=Object.entries(h).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=_()){var t;return Td(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new tf(null);const u=window.open(t||"",a,c);Mu(u,e,"popup-blocked");try{u.focus()}catch(e){}return new tf(u)}(e,rf(e,t,n,Hu(),i),sp())}async _openRedirect(e,t,n,i){var s;return await this._originValidation(e),s=rf(e,t,n,Hu(),i),op().location.href=s,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Uu(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Vp(e),n=op().gapi;return Mu(n,e,"internal-error"),t.open({where:document.body,url:Yp(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Kp,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=Lu(e,"network-request-failed"),r=op().setTimeout((()=>{i(s)}),Wp.get());function o(){op().clearTimeout(r),n(t)}t.ping(o).then(o,(()=>{i(s)}))}))))}(e),n=new Lp(e);return t.register("authEvent",(t=>(Mu(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(of,{type:of},(n=>{var i;const s=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[of];void 0!==s&&t(!!s),Du(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Yu(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(jp(e))return}catch(e){}Du(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ed()||_d()||Td()}};var hf="@firebase/auth",lf="0.21.5";class cf{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Mu(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const uf=g("authIdTokenMaxAge")||300;let df=null;var pf;pf="Browser",Le(new Y("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),{apiKey:s,authDomain:r}=n.options;return((e,n)=>{Mu(s&&!s.includes(":"),"invalid-api-key",{appName:e.name}),Mu(!(null==r?void 0:r.includes(":")),"argument-error",{appName:e.name});const i={apiKey:s,authDomain:r,clientPlatform:pf,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Cd(pf)},o=new Sd(e,n,i);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(qu);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,i)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Le(new Y("auth-internal",(e=>(e=>new cf(e))(Rd(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),He(hf,lf,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(pf)),He(hf,lf,"esm2017");const ff="firebasestorage.googleapis.com",gf="storageBucket";class mf extends E{constructor(e,t,n=0){super(wf(e),`Firebase Storage: ${t} (${wf(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,mf.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return wf(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var _f,yf,vf;function wf(e){return"storage/"+e}function If(e){return new mf(_f.INVALID_ARGUMENT,e)}function bf(){return new mf(_f.APP_DELETED,"The Firebase app was deleted.")}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(_f||(_f={}));class Tf{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Tf.makeFromUrl(e,t)}catch(t){return new Tf(e,"")}if(""===n.path)return n;throw i=e,new mf(_f.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)",s=new RegExp("^gs://"+i+"(/(.*))?$","i");function r(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:r},{regex:new RegExp(`^https?://${t===ff?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:r}];for(let t=0;t<a.length;t++){const i=a[t],s=i.regex.exec(e);if(s){const e=s[i.indices.bucket];let t=s[i.indices.path];t||(t=""),n=new Tf(e,t),i.postModify(n);break}}if(null==n)throw function(e){return new mf(_f.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Ef{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Cf(e,t,n,i){if(i<t)throw If(`Invalid value for '${e}'. Expected ${t} or greater.`);if(i>n)throw If(`Invalid value for '${e}'. Expected ${n} or less.`)}(vf=yf||(yf={}))[vf.NO_ERROR=0]="NO_ERROR",vf[vf.NETWORK_ERROR=1]="NETWORK_ERROR",vf[vf.ABORT=2]="ABORT";class kf{constructor(e,t,n,i,s,r,o,a,h,l,c,u=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=r,this.callback_=o,this.errorCallback_=a,this.timeout_=h,this.progressCallback_=l,this.connectionFactory_=c,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,i=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){i(e)}else if(null!==s){const e=new mf(_f.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=s.getErrorText(),this.errorCallback_?i(this.errorCallback_(s,e)):i(e)}else t.canceled?i(this.appDelete_?bf():new mf(_f.CANCELED,"User canceled the upload/download.")):i(new mf(_f.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new Sf(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,s=null,r=null,o=!1,a=0;function h(){return 2===a}let l=!1;function c(...e){l||(l=!0,t.apply(null,e))}function u(t){s=setTimeout((()=>{s=null,e(p,h())}),t)}function d(){r&&clearTimeout(r)}function p(e,...t){if(l)return void d();if(e)return d(),void c.call(null,e,...t);if(h()||o)return d(),void c.call(null,e,...t);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),u(n)}let f=!1;function g(e){f||(f=!0,d(),l||(null!==s?(e||(a=2),clearTimeout(s),u(0)):e||(a=1)))}return u(0),r=setTimeout((()=>{o=!0,g(!0)}),n),g}(((e,t)=>{if(t)return void e(!1,new Sf(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===yf.NO_ERROR,s=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),s=-1!==t.indexOf(e);return n||i||s}(s,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===yf.ABORT;return void e(!1,new Sf(!1,null,t))}const r=-1!==this.successCodes_.indexOf(s);e(!0,new Sf(r,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Sf{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}class Rf{constructor(e,t){this._service=e,this._location=t instanceof Tf?t:Tf.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Rf(e,t)}get root(){const e=new Tf(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Tf(this._location.bucket,e);return new Rf(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new mf(_f.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Nf(e,t){const n=null==t?void 0:t[gf];return null==n?null:Tf.makeFromBucketSpec(n,e)}class Af{constructor(e,t,n,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=ff,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?Tf.makeFromBucketSpec(i,this._host):Nf(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Tf.makeFromBucketSpec(this._url,e):this._bucket=Nf(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Cf("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Cf("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Rf(this,e)}_makeRequest(e,t,n,i,s=!0){if(this._deleted)return new Ef(bf());{const r=function(e,t,n,i,s,r,o=!0){const a=function(e){const t=encodeURIComponent;let n="?";for(const i in e)e.hasOwnProperty(i)&&(n=n+(t(i)+"=")+t(e[i])+"&");return n=n.slice(0,-1),n}(e.urlParams),h=e.url+a,l=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(l,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(l,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(l,r),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(l,i),new kf(h,e.method,l,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s,o)}(e,this._appId,n,i,t,this._firebaseVersion,s);return this._requests.add(r),r.getPromise().then((()=>this._requests.delete(r)),(()=>this._requests.delete(r))),r}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const Pf="@firebase/storage",Of="0.11.2",Df="storage";Le(new Y(Df,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new Af(n,i,s,t,Ue)}),"PUBLIC").setMultipleInstances(!0)),He(Pf,Of,""),He(Pf,Of,"esm2017");const Lf=document.querySelector(".logged-out"),xf=document.querySelector(".logged-in-menu");function Mf(){Lf.style.display="none",xf.style.display="flex"}function Ff(){Lf.style.display="flex",xf.style.display="none"}let Uf,jf;Ff();const qf=je({apiKey:"AIzaSyAR0CP4-z-kYWlvY-iLaTbaCrfn8QGIyqY",authDomain:"benet-coding-club.firebaseapp.com",projectId:"benet-coding-club",storageBucket:"benet-coding-club.appspot.com",messagingSenderId:"545186253378",appId:"1:545186253378:web:4a24a2ea92461e58a37bdb",measurementId:"G-F9LY9HPN88"}),Hf=(function(e=qe()){const t=xe(e=G(e),qt);t.isInitialized()?t.getImmediate():function(e,t={}){const n=xe(e,qt);if(n.isInitialized()){const e=n.getImmediate();if(L(t,n.getOptions()))return e;throw Gt.create("already-initialized")}n.initialize({options:t})}(e)}(qf),function(e=qe()){const t=xe(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=xe(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(L(n.getOptions(),null!=t?t:{}))return e;Du(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:af,persistence:[yp,ep,np]}),i=g("authTokenSyncURL");if(i){const e=(s=i,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>uf)return;const i=null==t?void 0:t.token;df!==i&&(df=i,await fetch(s,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(e,t,n){G(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t,n,i,s){G(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var s;const r=p("auth");return r&&function(e,t,n){const i=Rd(e);Mu(i._canInitEmulator,i,"emulator-config-failed"),Mu(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const s=!!(null==n?void 0:n.disableWarnings),r=Ad(t),{host:o,port:a}=function(e){const t=Ad(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const e=s[1];return{host:e,port:Pd(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Pd(t)}}}(t),h=null===a?"":`:${a}`;i.config.emulator={url:`${r}//${o}${h}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`),n}());let Bf;const Vf=document.querySelector(".signup-login");Vf.addEventListener("submit",(e=>{e.preventDefault(),Uf=Vf.email.value;const t=Vf.password.value;jf=Uf.split("@")[0],async function(e,t,n){const i=Rd(e),s=await async function(e,t){return Ju(e,"POST","/v1/accounts:signUp",Gu(e,t))}(i,{returnSecureToken:!0,email:t,password:n}),r=await $d._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(r.user),r}(Hf,Uf,t).then((e=>{Vf.reset(),Bf=e.user.uid,Mf()})).catch((e=>{console.log(e.message)}))})),document.querySelector(".logout").addEventListener("click",(()=>{(function(e){return G(e).signOut()})(Hf).then((()=>{console.log("user signed out"),Ff(),null!=localStorage.getItem("savedEmail")&&null!=localStorage.getItem("savedPassword")&&null!=localStorage.getItem("savedUsername")&&(document.querySelector(".email-input").value=localStorage.getItem("savedEmail"),document.querySelector(".password-input").value=localStorage.getItem("savedPassword"),document.querySelector(".username-input").value=localStorage.getItem("savedUsername"))})).catch((e=>{console.log(e.message)}))}));const Wf=document.querySelector(".signup-login");Wf.addEventListener("submit",(e=>{e.preventDefault();const t=Wf.email.value,n=Wf.password.value;zf?(localStorage.setItem("savedEmail",t),localStorage.setItem("savedPassword",n)):(localStorage.removeItem("savedEmail"),localStorage.removeItem("savedPassword")),function(e,t,n){return async function(e,t){return Xd(Rd(e),t)}(G(e),jd.credential(t,n))}(Hf,t,n).then((e=>{Wf.reset(),Bf=e.user.uid,Mf()})).catch((e=>{console.log(e.message)}))}));let zf=!0;document.querySelector(".control-checkbox").checked=!1;var $f=document.querySelector(".control-checkbox"),Kf=$f.querySelector(".remember-me-check");$f.addEventListener("click",(function(){zf=!!Kf.checked})),null!=localStorage.getItem("savedEmail")&&null!=localStorage.getItem("savedPassword")&&(document.querySelector(".email-input").value=localStorage.getItem("savedEmail"),document.querySelector(".password-input").value=localStorage.getItem("savedPassword")),function(e=qe(),t){const n=xe(e=G(e),Df).getImmediate({identifier:t}),i=(e=>{const t=p(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]})("storage");i&&function(e,t,n,i={}){!function(e,t,n,i={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:s}=i;s&&(e._overrideAuthToken="string"==typeof s?s:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[h(JSON.stringify({alg:"none",type:"JWT"})),h(JSON.stringify(r)),""].join(".")}(s,e.app.options.projectId))}(e,t,n,i)}(n,...i)}(qf)})();